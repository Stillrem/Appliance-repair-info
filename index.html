<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Appliance Repair Pro</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#34c759" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Repair Pro" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
    <style>
        /* === –í–ê–®–ò –°–¢–ò–õ–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô === */
        :root { --primary: #34c759; --primary-dark: #30d158; --background: #000000; --surface: #1c1c1e; --surface-2: #2c2c2e; --surface-3: #3a3a3c; --text: #ffffff; --text-secondary: #8e8e93; --border: #2c2c2e; --shadow: rgba(0, 0, 0, 0.3);}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:var(--background);color:var(--text);min-height:100vh;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);overflow-x:hidden;}
        .container{max-width:100%;padding:20px;margin:0 auto;min-height:100vh;}
        .header{text-align:center;margin-bottom:30px;padding:20px 0;}
        .logo{width:60px;height:60px;background:linear-gradient(135deg, var(--primary), var(--primary-dark));border-radius:15px;margin:0 auto 15px;display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow:0 8px 32px rgba(52,199,89,0.3);}
        .title{font-size:28px;font-weight:700;margin-bottom:8px;background:linear-gradient(135deg, var(--primary), var(--primary-dark));-webkit-background-clip: text;-webkit-text-fill-color: transparent;background-clip:text;}
        .subtitle{color:var(--text-secondary);font-size:16px;font-weight:500;}
        .mode-toggle{display:flex;background:var(--surface);border-radius:12px;padding:4px;margin:25px 0;box-shadow:inset 0 1px 3px var(--shadow);}
        .mode-btn{flex:1;padding:12px 16px;border:none;background:transparent;color:var(--text-secondary);border-radius:8px;font-weight:600;font-size:15px;transition:all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);cursor:pointer;}
        .mode-btn.active{background:var(--primary);color:var(--text);box-shadow:0 2px 8px rgba(52,199,89,0.3);transform:scale(1.02);}
        .form-section{background:var(--surface);border-radius:16px;padding:24px;margin-bottom:20px;border:1px solid var(--border);box-shadow:0 4px 16px rgba(0,0,0,0.1);}
        .section-title{font-size:18px;font-weight:700;color:var(--primary);margin-bottom:20px;display:flex;align-items:center;gap:8px;}
        .form-group{margin-bottom:20px;}
        .form-group:last-child{margin-bottom:0;}
        .label{display:block;font-weight:600;margin-bottom:8px;color:var(--text);font-size:16px;}
        .translation{color:var(--text-secondary);font-size:14px;font-style:italic;display:block;margin-top:2px;}
        .translation.hidden{display:none;}
        select,input,textarea{width:100%;padding:16px;background:var(--surface-2);border:1.5px solid var(--border);border-radius:12px;color:var(--text);font-size:16px;font-family:inherit;transition:all 0.3s ease;-webkit-appearance:none;appearance:none;}
        select{background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right 12px center;background-size:20px;padding-right:50px;cursor:pointer;}
        select:focus,input:focus,textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(52,199,89,0.1);transform:translateY(-1px);}
        input::placeholder,textarea::placeholder{color:var(--text-secondary);}
        textarea{min-height:100px;resize:vertical;line-height:1.5;}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:15px;}
        .action-buttons{display:flex;gap:12px;margin-top:30px;}
        .btn{flex:1;padding:16px 24px;border:none;border-radius:12px;font-weight:600;font-size:16px;transition:all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);cursor:pointer;position:relative;overflow:hidden;}
        .btn:active{transform:scale(0.98);}
        .btn-primary{background:linear-gradient(135deg, var(--primary), var(--primary-dark));color:var(--text);box-shadow:0 4px 16px rgba(52,199,89,0.3);}
        .btn-primary:hover{box-shadow:0 6px 20px rgba(52,199,89,0.4);transform:translateY(-2px);}
        .btn-secondary{background:var(--surface-2);color:var(--text);border:1px solid var(--border);}
        .btn-secondary:hover{background:var(--surface-3);transform:translateY(-1px);}
        .report-output{background:var(--surface);border-radius:16px;padding:24px;margin-top:30px;border:1px solid var(--border);box-shadow:0 4px 16px rgba(0,0,0,0.1);}
        .report-title{font-size:20px;font-weight:700;margin-bottom:20px;color:var(--primary);display:flex;align-items:center;gap:8px;}
        .report-content{line-height:1.8;}
        .report-line{margin-bottom:12px;padding:12px 0;border-bottom:1px solid var(--border);}
        .report-line:last-child{border-bottom:none;margin-bottom:0;}
        .report-label{font-weight:600;color:var(--text-secondary);font-size:14px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px;}
        .report-value{font-size:16px;color:var(--text);}
        .templates{margin-top:30px;}
        .templates-title{font-size:18px;font-weight:700;color:var(--primary);margin-bottom:15px;display:flex;align-items:center;gap:8px;}
        .template-btn{width:100%;padding:16px;background:var(--surface-2);border:1px solid var(--border);border-radius:12px;color:var(--text);text-align:left;margin-bottom:12px;font-size:15px;cursor:pointer;transition:all 0.3s ease;line-height:1.4;}
        .template-btn:hover{background:var(--surface-3);border-color:var(--primary);transform:translateY(-1px);}
        .template-btn:active{transform:scale(0.98);}
        .template-main{font-weight:600;margin-bottom:4px;}
        .template-translation{color:var(--text-secondary);font-size:13px;}
        .hidden{display:none !important;}
        .status-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:8px;}
        .status-completed{background:#34c759;}
        .status-partial{background:#ff9500;}
        .status-pending{background:#007aff;}
        .status-unrepairable{background:#ff3b30;}
        .install-prompt{position:fixed;bottom:20px;left:20px;right:20px;background:var(--surface);border:1px solid var(--primary);border-radius:16px;padding:20px;display:none;z-index:1000;box-shadow:0 8px 32px rgba(0,0,0,0.3);}
        .install-prompt.show{display:block;animation:slideUp 0.3s ease;}
        @keyframes slideUp{from{transform:translateY(100%);opacity:0;}to{transform:translateY(0);opacity:1;}}
        .install-text{margin-bottom:12px;font-weight:500;}
        .install-buttons{display:flex;gap:10px;}
        .install-btn{background:var(--primary);color:var(--text);border:none;padding:10px 16px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.3s ease;}
        .close-btn{background:var(--surface-2);color:var(--text-secondary);border:none;padding:10px 16px;border-radius:8px;font-weight:500;font-size:14px;cursor:pointer;}
        @media (max-width:480px){.container{padding:15px;}.title{font-size:24px;}.form-row{grid-template-columns:1fr;gap:12px;}.action-buttons{flex-direction:column;}.btn{padding:14px 20px;}}
        @media (min-width:768px){.container{max-width:600px;}}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üîß</div>
            <h1 class="title">Appliance Repair Pro</h1>
            <p class="subtitle">Professional Service Reports</p>

            <div class="mode-toggle">
                <button class="mode-btn active" data-mode="technician">üë®‚Äçüîß Technician</button>
                <button class="mode-btn" data-mode="client">üë§ Client</button>
            </div>
        </div>

        <form id="repairForm" autocomplete="off">
            <div class="form-section">
                <div class="section-title">üè† Appliance Information</div>

                <div class="form-group">
                    <label class="label">
                        Appliance Type
                        <span class="translation">–¢–∏–ø —Ç–µ—Ö–Ω–∏–∫–∏</span>
                    </label>
                    <select id="category" required>
                        <option value="">Select Appliance Type</option>
                        <option value="refrigerator">Refrigerator / –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫</option>
                        <option value="dishwasher">Dishwasher / –ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞</option>
                        <option value="washing_machine">Washing Machine / –°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞</option>
                        <option value="dryer">Dryer / –°—É—à–∏–ª–∫–∞</option>
                        <option value="stove_oven">Stove/Oven / –ü–ª–∏—Ç–∞/–î—É—Ö–æ–≤–∫–∞</option>
                        <option value="microwave">Microwave / –ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="label">
                            Brand
                            <span class="translation">–ë—Ä–µ–Ω–¥</span>
                        </label>
                        <select id="brand" required>
                            <option value="">Select Brand</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="label">
                            Model
                            <span class="translation">–ú–æ–¥–µ–ª—å</span>
                        </label>
                        <input type="text" id="model" placeholder="Enter model number" required />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="label">
                            Serial Number
                            <span class="translation">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</span>
                        </label>
                        <input type="text" id="serial" placeholder="Enter serial number" />
                    </div>
                    <div class="form-group">
                        <label class="label">
                            Year of Manufacture
                            <span class="translation">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</span>
                        </label>
                        <input type="text" id="year" placeholder="2020" />
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-title">üîç Service Details</div>

                <div class="form-group">
                    <label class="label">
                        Problem
                        <span class="translation">–ü—Ä–æ–±–ª–µ–º–∞</span>
                    </label>
                    <select id="problem" required>
                        <option value="">Select Problem</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="label">
                        Diagnosis
                        <span class="translation">–î–∏–∞–≥–Ω–æ–∑</span>
                    </label>
                    <select id="diagnosis" required>
                        <option value="">Select Diagnosis</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="label">
                        Action Taken
                        <span class="translation">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</span>
                    </label>
                    <select id="action" required>
                        <option value="">Select Action</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="label">
                        Status
                        <span class="translation">–°—Ç–∞—Ç—É—Å</span>
                    </label>
                    <select id="status" required>
                        <option value="">Select Status</option>
                        <option value="completed">‚úÖ Fixed 100% / –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ</option>
                        <option value="waiting">‚è≥ Waiting for Part / –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—á–∞—Å—Ç–∏</option>
                        <option value="temporary">üîß Temporary Fix / –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ</option>
                        <option value="unrepairable">‚ùå Not Repairable / –ù–µ –ø–æ–¥–ª–µ–∂–∏—Ç —Ä–µ–º–æ–Ω—Ç—É</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="label">
                        Additional Notes
                        <span class="translation">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏</span>
                    </label>
                    <textarea id="notes" placeholder="Enter any additional details or recommendations..."></textarea>
                </div>

                <div class="form-group">
                    <label class="label">
                        Price
                        <span class="translation">–°—Ç–æ–∏–º–æ—Å—Ç—å</span>
                    </label>
                    <input type="number" id="price" placeholder="Enter price" min="0" step="1" />
                </div>
            </div>

            <div class="action-buttons">
                <button type="submit" class="btn btn-primary">üìã Generate Report</button>
                <button type="button" class="btn btn-secondary" id="clearBtn">üóëÔ∏è Clear Form</button>
            </div>
        </form>

        <div id="reportOutput" class="report-output hidden">
            <div class="report-title">üìÑ Service Report</div>
            <div id="reportContent" class="report-content"></div>
        </div>

        <div class="templates">
            <div class="templates-title">üí¨ Customer Message Templates</div>
            <button class="template-btn" data-template="completion">
                <div class="template-main">‚úÖ Service completed successfully - Your appliance is working perfectly</div>
                <div class="template-translation">‚úÖ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ - –í–∞—à–∞ —Ç–µ—Ö–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ</div>
            </button>
            <button class="template-btn" data-template="parts">
                <div class="template-main">üîß Part ordered - We'll return within 3-5 business days to complete the repair</div>
                <div class="template-translation">üîß –ó–∞–ø—á–∞—Å—Ç—å –∑–∞–∫–∞–∑–∞–Ω–∞ - –í–µ—Ä–Ω–µ–º—Å—è —á–µ—Ä–µ–∑ 3-5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞</div>
            </button>
            <button class="template-btn" data-template="estimate">
                <div class="template-main">üí∞ Repair estimate provided - Please review and let us know your decision</div>
                <div class="template-translation">üí∞ –°–º–µ—Ç–∞ —Ä–µ–º–æ–Ω—Ç–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ - –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏ —Å–æ–æ–±—â–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ</div>
            </button>
            <button class="template-btn" data-template="warranty">
                <div class="template-main">üõ°Ô∏è Repair covered under warranty - No charge for today's service</div>
                <div class="template-translation">üõ°Ô∏è –†–µ–º–æ–Ω—Ç –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏–µ–π - –°–µ–≥–æ–¥–Ω—è—à–Ω–µ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
            </button>
        </div>
    </div>

    <div class="install-prompt" id="installPrompt">
        <div class="install-text">üì± Install this app on your home screen for quick access!</div>
        <div class="install-buttons">
            <button class="install-btn" id="installBtn">Install</button>
            <button class="close-btn" id="closePrompt">Close</button>
        </div>
    </div>

<script>
// --- –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ---
const applianceData = {
    refrigerator: {brands: [...],problems: [...],diagnosis: [...],actions: [...]},
    dishwasher: {brands: [...],problems: [...],diagnosis: [...],actions: [...]},
    washing_machine: {brands: [...],problems: [...],diagnosis: [...],actions: [...]},
    dryer: {brands: [...],problems: [...],diagnosis: [...],actions: [...]},
    stove_oven: {brands: [...],problems: [...],diagnosis: [...],actions: [...]},
    microwave: {brands: [...],problems: [...],diagnosis: [...],actions: [...]}
};
// (–í–°–¢–ê–í–¨–¢–ï –°–í–û–ò –ü–û–õ–ù–´–ï –ú–ê–°–°–ò–í–´ –ò–ó –ü–†–ï–î–´–î–£–©–ò–• –í–ê–†–ò–ê–ù–¢–û–í!)

// --- DOM Elements ---
const categorySelect = document.getElementById('category');
const brandSelect = document.getElementById('brand');
const problemSelect = document.getElementById('problem');
const diagnosisSelect = document.getElementById('diagnosis');
const actionSelect = document.getElementById('action');
const form = document.getElementById('repairForm');
const clearBtn = document.getElementById('clearBtn');

// --- –î–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π ---
let customProblems = JSON.parse(localStorage.getItem('arpro_custom_problems')||'{}');
let customDiagnosis = JSON.parse(localStorage.getItem('arpro_custom_diagnosis')||'{}');
let customActions = JSON.parse(localStorage.getItem('arpro_custom_actions')||'{}');

function reloadSelect(select, arr, customs, key){
    select.innerHTML = `<option value="">Select ${key.charAt(0).toUpperCase()+key.slice(1)}</option>`;
    arr.forEach(obj=>{
        select.insertAdjacentHTML('beforeend', `<option>${obj.en} / ${obj.ru}</option>`);
    });
    const cc = customs[categorySelect.value]||[];
    cc.forEach(({en,ru},i)=>{
        select.insertAdjacentHTML('beforeend', `<option data-custom="1" data-idx="${i}">${en}${ru?' / '+ru:''} ‚òÖ</option>`);
    });
}
function updateAllCategoryFields(){
    const c = categorySelect.value;
    if(!c || !applianceData[c]) {
        brandSelect.innerHTML='<option value="">Select Brand</option>';
        reloadSelect(problemSelect,[],customProblems,'problem');
        reloadSelect(diagnosisSelect,[],customDiagnosis,'diagnosis');
        reloadSelect(actionSelect,[],customActions,'action');
        return;
    }
    brandSelect.innerHTML='<option value="">Select Brand</option>';
    applianceData[c].brands.forEach(br=>{
        let op=document.createElement('option');
        op.value=br;
        op.textContent=br;
        brandSelect.appendChild(op);
    });
    reloadSelect(problemSelect,applianceData[c].problems,customProblems,'problem');
    reloadSelect(diagnosisSelect,applianceData[c].diagnosis,customDiagnosis,'diagnosis');
    reloadSelect(actionSelect,applianceData[c].actions,customActions,'action');
}
// --- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø—É–Ω–∫—Ç—ã: dblclick –ø–æ select –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, delete –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è ---
function addCustomToSelect(select, typeKey, storageObj) {
    if (!categorySelect.value) return alert('Choose appliance type first!');
    let en = prompt('Custom (en):');
    if(!en) return;
    let ru = prompt('Custom (ru):')||'';
    let arr = storageObj[categorySelect.value] || [];
    arr.push({en,ru});
    storageObj[categorySelect.value] = arr;
    localStorage.setItem(typeKey, JSON.stringify(storageObj));
    updateAllCategoryFields();
}
function removeCustomFromSelect(select, typeKey, storageObj) {
    let idx = select.selectedIndex;
    let opt = select.options[idx];
    if (opt && opt.dataset.custom) {
        if (confirm('Remove this custom entry?')) {
            let arr = storageObj[categorySelect.value] || [];
            arr.splice(opt.dataset.idx, 1);
            storageObj[categorySelect.value] = arr;
            localStorage.setItem(typeKey, JSON.stringify(storageObj));
            updateAllCategoryFields();
        }
    }
}
problemSelect.ondblclick = () => addCustomToSelect(problemSelect, 'arpro_custom_problems', customProblems);
diagnosisSelect.ondblclick = () => addCustomToSelect(diagnosisSelect, 'arpro_custom_diagnosis', customDiagnosis);
actionSelect.ondblclick = () => addCustomToSelect(actionSelect, 'arpro_custom_actions', customActions);
[problemSelect,diagnosisSelect,actionSelect].forEach((sel,i)=>{
    sel.onkeydown=(e)=>{
        if(e.key==='Delete'){
            ['arpro_custom_problems','arpro_custom_diagnosis','arpro_custom_actions'].forEach((t,n)=>{
                if(i===n) removeCustomFromSelect(sel,t,
                    t==='arpro_custom_problems'?customProblems:t==='arpro_custom_diagnosis'?customDiagnosis:customActions );
            });
        }
    };
});

// --- –ò—Å—Ç–æ—Ä–∏—è ---
let reportsArr = JSON.parse(localStorage.getItem('arpro_reports_history')||'[]');
function getCurrentReport(){
    return {
        date:new Date().toLocaleString(),
        appliance: categorySelect.options[categorySelect.selectedIndex]?.text ?? '',
        brand: brandSelect.options[brandSelect.selectedIndex]?.text ?? '',
        model: document.getElementById('model').value.trim(),
        serial: document.getElementById('serial').value.trim(),
        year: document.getElementById('year').value.trim(),
        problem: problemSelect.options[problemSelect.selectedIndex]?.text ?? '',
        diagnosis: diagnosisSelect.options[diagnosisSelect.selectedIndex]?.text ?? '',
        action: actionSelect.options[actionSelect.selectedIndex]?.text ?? '',
        status: document.getElementById('status').options[document.getElementById('status').selectedIndex]?.text ?? '',
        notes: document.getElementById('notes').value.trim(),
        price: document.getElementById('price').value.trim()
    };
}
function reportToText(r){
    return `[${r.appliance}]
Brand: ${r.brand}
Model: ${r.model}
Serial#: ${r.serial}
Year: ${r.year}
Problem: ${r.problem}
Diagnosis: ${r.diagnosis}
Action: ${r.action}
Status: ${r.status}
Notes: ${r.notes}
Price: ${r.price}
Date: ${r.date}`.trim();
}
function renderAllReports(){
    let out = '';
    reportsArr.forEach((r,idx) => out+=`
        <div class="report-output" style="margin-top:24px;">
          <div class="report-title">üìÑ Report #${idx+1}</div>
          <div class="report-content">
             <div class="report-line"><span class="report-label">Date:</span> <span class="report-value">${r.date||''}</span></div>
             <div class="report-line"><span class="report-label">Appliance Type:</span> <span class="report-value">${r.appliance}</span></div>
             <div class="report-line"><span class="report-label">Brand:</span> <span class="report-value">${r.brand}</span></div>
             <div class="report-line"><span class="report-label">Model:</span> <span class="report-value">${r.model}</span></div>
             <div class="report-line"><span class="report-label">Serial:</span> <span class="report-value">${r.serial}</span></div>
             <div class="report-line"><span class="report-label">Year of Manufacture:</span> <span class="report-value">${r.year}</span></div>
             <div class="report-line"><span class="report-label">Problem:</span> <span class="report-value">${r.problem}</span></div>
             <div class="report-line"><span class="report-label">Diagnosis:</span> <span class="report-value">${r.diagnosis}</span></div>
             <div class="report-line"><span class="report-label">Action Taken:</span> <span class="report-value">${r.action}</span></div>
             <div class="report-line"><span class="report-label">Status:</span> <span class="report-value">${r.status}</span></div>
             <div class="report-line"><span class="report-label">Additional Notes:</span> <span class="report-value">${r.notes}</span></div>
             <div class="report-line"><span class="report-label">Price:</span> <span class="report-value">${r.price}</span></div>
          </div>
        </div>`);
    if (!document.getElementById('allReportsBlock')) {
        let allRepHtml = document.createElement('div');
        allRepHtml.id = 'allReportsBlock';
        form.parentNode.insertBefore(allRepHtml, document.querySelector('.templates'));
    }
    document.getElementById('allReportsBlock').innerHTML = out;
    if (!document.getElementById('reportsControlBtns')) {
        let repBlock = document.createElement('div');
        repBlock.id = 'reportsControlBtns';
        repBlock.className = 'action-buttons';
        repBlock.innerHTML = `
            <button type="button" class="btn btn-primary" id="copyAllBtn">üìë Copy All Reports</button>
            <button type="button" class="btn btn-primary" id="copyLastBtn">üìã Copy Last Report</button>
            <button type="button" class="btn btn-secondary" id="clearAllBtn">üóëÔ∏è Clear All Reports</button>
        `;
        form.parentNode.insertBefore(repBlock, document.getElementById('allReportsBlock'));
        repBlock.querySelector('#copyAllBtn').onclick = () => {
            if(reportsArr.length) navigator.clipboard.writeText(reportsArr.map(reportToText).join('\n\n====\n\n'));
        };
        repBlock.querySelector('#copyLastBtn').onclick = () => {
            if(reportsArr.length) navigator.clipboard.writeText(reportToText(reportsArr[reportsArr.length-1]));
        };
        repBlock.querySelector('#clearAllBtn').onclick = () => {
            if(confirm('Clear ALL reports?')){
                reportsArr.length = 0; renderAllReports(); localStorage.setItem('arpro_reports_history','[]');
            }
        };
    }
    document.getElementById('reportsControlBtns').classList.toggle('hidden', reportsArr.length === 0);
}
categorySelect.addEventListener('change',updateAllCategoryFields);
form.addEventListener('submit', e => {
    e.preventDefault();
    const report = getCurrentReport();
    reportsArr.push(report);
    localStorage.setItem('arpro_reports_history', JSON.stringify(reportsArr));
    renderAllReports();
    form.reset(); updateAllCategoryFields();
});
clearBtn.addEventListener('click', () => {form.reset();updateAllCategoryFields();});
window.addEventListener('DOMContentLoaded',()=>{renderAllReports();updateAllCategoryFields();document.querySelectorAll('.translation').forEach(el=>el.classList.remove('hidden'));});
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ Client/Technician
const modeButtons = document.querySelectorAll('.mode-btn');
modeButtons.forEach(button => {
    button.addEventListener('click', () => {
        modeButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        const isClient = button.getAttribute('data-mode') === 'client';
        document.querySelectorAll('.translation').forEach(el=>{
            if(isClient) el.classList.add('hidden'); else el.classList.remove('hidden');
        });
    });
});
</script>
</body>
</html>
