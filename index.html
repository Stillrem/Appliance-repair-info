<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Appliance Repair Pro</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#34c759" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Repair Pro" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
    <style>
        :root { --primary: #34c759; --primary-dark: #30d158; --danger: #ff453a; --input-bg: #2c2c2e; --input-border: #454545; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif; background: #000; color: #fff; min-height: 100vh; padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
        .container { max-width: 100%; padding: 20px; min-height: 100vh; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px 0;}
        .logo { width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 15px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 8px 32px rgba(52,199,89,.3);}
        .title { font-size: 28px; font-weight: 700; margin-bottom: 8px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); -webkit-background-clip: text;-webkit-text-fill-color: transparent; background-clip: text;}
        .subtitle { color: #8e8e93; font-size: 16px; font-weight: 500;}
        .mode-toggle { display:flex; background:#1c1c1e; border-radius:12px; padding:4px; margin:25px 0; box-shadow:inset 0 1px 3px rgba(0,0,0,.3);}
        .mode-btn {flex:1; padding:12px 16px; border:none; background:transparent; color:#8e8e93; border-radius:8px; font-weight:600; font-size:15px; transition:.3s; cursor:pointer;}
        .mode-btn.active {background: var(--primary); color:#fff; box-shadow:0 2px 8px rgba(52,199,89,.3);}
        .form-section {background:#1c1c1e; border-radius:16px; padding:24px; margin-bottom:20px; border:1px solid #2c2c2e; box-shadow:0 4px 16px rgba(0,0,0,.1);}
        .section-title {font-size:18px; font-weight:700; color:var(--primary); margin-bottom:20px; display: flex; align-items:center;}
        .form-group {margin-bottom:20px;}
        .form-group:last-child {margin-bottom:0;}
        .label {display:block; font-weight:600; margin-bottom:8px; color:#fff; font-size:16px;}
        .translation { color: #8e8e93; font-size:14px; font-style: italic; display: block; margin-top:2px;}
        .translation.hidden {display:none;}
        select,input,textarea {width:100%; padding:16px; background:var(--input-bg); border:1.5px solid var(--input-border); border-radius:12px; color:#fff; font-size:16px; transition:.3s;}
        select {background-image:url("data:image/svg+xml,%3csvg viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'/%3e%3c/svg%3e");
            background-repeat:no-repeat; background-position:right 12px center; background-size:20px; padding-right:50px; cursor:pointer;}
        select:focus,input:focus,textarea:focus {outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(52,199,89,.1);}
        input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0;}
        input[type=number] {appearance:textfield;}
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px;}
        .action-buttons { display:flex; gap:12px; margin-top:30px;}
        .btn { flex:1; padding:16px 24px; border:none; border-radius:12px; font-weight:600; font-size:16px; transition:.3s; cursor:pointer;}
        .btn:active {transform:scale(.98);}
        .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff; box-shadow:0 4px 16px rgba(52,199,89,.3);}
        .btn-primary:hover {box-shadow:0 6px 20px rgba(52,199,89,.4);transform:translateY(-2px);}
        .btn-secondary {background:#2c2c2e;color:#fff; border:1px solid #2c2c2e;}
        .btn-secondary:hover {background:#3a3a3c;}
        .inline-btns { display: flex; gap: 0.4em; position: absolute; right:8px; top:50%; transform: translateY(-50%); }
        .plus-add-btn { background: var(--primary); color: #fff; border: none; border-radius:50%; width: 32px; height:32px; font-size:20px; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; box-shadow: 0 3px 12px rgba(52,199,89,0.13); transition:.12s;}
        .plus-add-btn:hover {background: var(--primary-dark);}
        .trash-btn {background: var(--danger); color:#fff; border:none; border-radius:50%; width:32px; height:32px; font-size:18px; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; transition:.12s;}
        .trash-btn:hover {background: #ff796a;}
        .form-group-select-wrap { position: relative; }
        .custom-choice { display: flex; align-items:center; justify-content:space-between;}
        .custom-item-label {display:inline;}
        .report-output {background:#1c1c1e; border-radius:16px; padding:24px; margin-top:30px; border:1px solid #2c2c2e; box-shadow:0 4px 16px rgba(0,0,0,.1);}
        .report-title {font-size:20px;font-weight:700;margin-bottom:20px;color:var(--primary);}
        .report-content {line-height:1.8;}
        .report-line {margin-bottom:12px;padding:12px 0;border-bottom:1px solid #2c2c2e;}
        .report-line:last-child {border-bottom:none;margin-bottom:0;}
        .report-label {font-weight:600;color:#8e8e93;font-size:14px;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;}
        .report-value {font-size:16px;color:#fff;}
        .templates {margin-top:30px;}
        .templates-title {font-size:18px;font-weight:700;color:var(--primary);margin-bottom:15px;display:flex;align-items: center;}
        .template-btn {width:100%;padding:16px;background:#2c2c2e;border:1px solid #2c2c2e;border-radius:12px;color:#fff;text-align:left;margin-bottom:12px;font-size:15px;cursor:pointer;transition:.3s;}
        .template-btn:hover {background:#3a3a3c;}
        .template-main {font-weight:600;margin-bottom:4px;}
        .template-translation {color:#8e8e93;font-size:13px;}
        .hidden {display:none !important;}
        @media (max-width: 480px) { .container{padding:15px;}.title{font-size:24px;}.form-row{grid-template-columns:1fr;gap:12px;}.action-buttons{flex-direction:column;}.btn{padding:14px 20px;}}
        @media (min-width: 768px){.container{max-width:600px;}}
        /* Year+Month fix */
        .form-group-row {display: grid;grid-template-columns: 1fr 1fr; gap: 13px; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="logo">üîß</div>
        <h1 class="title">Appliance Repair Pro</h1>
        <p class="subtitle">Professional Service Reports</p>
        <div class="mode-toggle">
            <button class="mode-btn active" data-mode="technician">üë®‚Äçüîß Technician</button>
            <button class="mode-btn" data-mode="client">üë§ Client</button>
        </div>
    </div>
    <form id="repairForm">
        <div class="form-section">
            <div class="section-title">üè† Appliance Information</div>
            <div class="form-group">
                <label class="label">
                    Appliance Type
                    <span class="translation">–¢–∏–ø —Ç–µ—Ö–Ω–∏–∫–∏</span>
                </label>
                <div class="form-group-select-wrap">
                    <select id="category" required></select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="label">
                        Brand
                        <span class="translation">–ë—Ä–µ–Ω–¥</span>
                    </label>
                    <div class="form-group-select-wrap">
                        <select id="brand" required></select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="label">
                        Model
                        <span class="translation">–ú–æ–¥–µ–ª—å</span>
                    </label>
                    <input type="text" id="model" placeholder="Enter model number" required />
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group">
                    <label class="label">
                        Serial Number
                        <span class="translation">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</span>
                    </label>
                    <input type="text" id="serial" placeholder="Enter serial number" />
                </div>
                <div class="form-group">
                    <label class="label">
                        Year of Manufacture
                        <span class="translation">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</span>
                    </label>
                    <input type="number" id="year" min="1990" max="2099" step="1" placeholder="YYYY" style="margin-bottom:7px;">
                    <input type="number" id="month" min="1" max="12" step="1" placeholder="MM">
                </div>
            </div>
        </div>
        <div class="form-section">
            <div class="section-title">üîç Service Details</div>
            <div class="form-group">
                <label class="label">Problem <span class="translation">–ü—Ä–æ–±–ª–µ–º–∞</span></label>
                <div class="form-group-select-wrap">
                    <select id="problem" required></select>
                    <div class="inline-btns">
                        <button type="button" class="plus-add-btn" data-add="problem" title="Add Problem">+</button>
                    </div>
                </div>
                <ul id="problem-custom-list" class="custom-list" style="list-style:none;margin:0;padding:0;"></ul>
            </div>
            <div class="form-group">
                <label class="label">Diagnosis <span class="translation">–î–∏–∞–≥–Ω–æ–∑</span></label>
                <div class="form-group-select-wrap">
                    <select id="diagnosis" required></select>
                    <div class="inline-btns">
                        <button type="button" class="plus-add-btn" data-add="diagnosis" title="Add Diagnosis">+</button>
                    </div>
                </div>
                <ul id="diagnosis-custom-list" class="custom-list" style="list-style:none;margin:0;padding:0;"></ul>
            </div>
            <div class="form-group">
                <label class="label">Action Taken <span class="translation">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</span></label>
                <div class="form-group-select-wrap">
                    <select id="action" required></select>
                    <div class="inline-btns">
                        <button type="button" class="plus-add-btn" data-add="action" title="Add Action">+</button>
                    </div>
                </div>
                <ul id="action-custom-list" class="custom-list" style="list-style:none;margin:0;padding:0;"></ul>
            </div>
            <div class="form-group">
                <label class="label">Status <span class="translation">–°—Ç–∞—Ç—É—Å</span></label>
                <div class="form-group-select-wrap">
                    <select id="status" required></select>
                </div>
            </div>
            <div class="form-group">
                <label class="label">
                    Additional Notes
                    <span class="translation">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏</span>
                </label>
                <textarea id="notes" placeholder="Enter any additional details or recommendations..."></textarea>
            </div>
        </div>
        <div class="action-buttons">
            <button type="submit" class="btn btn-primary">üìã Generate Report</button>
            <button type="button" class="btn btn-secondary" id="clearBtn">üóëÔ∏è Clear Form</button>
        </div>
    </form>
    <div id="reportsControlBtns" class="action-buttons hidden" style="margin-top:24px;">
        <button type="button" class="btn btn-primary" id="copyAllBtn">üìë Copy All Reports</button>
        <button type="button" class="btn btn-primary" id="copyLastBtn">üìã Copy Last Report</button>
        <button type="button" class="btn btn-secondary" id="clearAllBtn">üóëÔ∏è Clear All Reports</button>
    </div>
    <div id="allReportsBlock"></div>
    <div class="templates">
        <div class="templates-title">üí¨ Customer Message Templates</div>
        <button class="template-btn" data-template="completion">
            <div class="template-main">‚úÖ Service completed successfully - Your appliance is working perfectly</div>
            <div class="template-translation">‚úÖ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ - –í–∞—à–∞ —Ç–µ—Ö–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ</div>
        </button>
        <button class="template-btn" data-template="parts">
            <div class="template-main">üîß Part ordered - We'll return within 3-5 business days to complete the repair</div>
            <div class="template-translation">üîß –ó–∞–ø—á–∞—Å—Ç—å –∑–∞–∫–∞–∑–∞–Ω–∞ - –í–µ—Ä–Ω–µ–º—Å—è —á–µ—Ä–µ–∑ 3-5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞</div>
        </button>
        <button class="template-btn" data-template="estimate">
            <div class="template-main">üí∞ Repair estimate provided - Please review and let us know your decision</div>
            <div class="template-translation">üí∞ –°–º–µ—Ç–∞ —Ä–µ–º–æ–Ω—Ç–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ - –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏ —Å–æ–æ–±—â–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ</div>
        </button>
        <button class="template-btn" data-template="warranty">
            <div class="template-main">üõ°Ô∏è Repair covered under warranty - No charge for today's service</div>
            <div class="template-translation">üõ°Ô∏è –†–µ–º–æ–Ω—Ç –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏–µ–π - –°–µ–≥–æ–¥–Ω—è—à–Ω–µ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
        </button>
    </div>
</div>
<script>
const applianceData = {
    refrigerator: {
        brands: ['GE','Samsung','Whirlpool','LG','Kenmore','KitchenAid','Frigidaire','Maytag','Bosch','Electrolux','Haier','Panasonic','Beko','Hotpoint','Indesit','Miele','Ariston','Sharp','Smeg','Hitachi'],
        problems: [
            { en: "Not cooling properly", ru: "–ù–µ –æ—Ö–ª–∞–∂–¥–∞–µ—Ç –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º" },
            { en: "Making loud noises", ru: "–ò–∑–¥–∞–µ—Ç –≥—Ä–æ–º–∫–∏–µ –∑–≤—É–∫–∏" },
            { en: "Leaking water", ru: "–¢–µ—á–µ—Ç –≤–æ–¥–∞" },
            { en: "Ice maker not working", ru: "–õ—å–¥–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç" },
            { en: "Defrost issues", ru: "–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞–∑–º–æ—Ä–æ–∑–∫–∞" },
            { en: "Compressor running constantly", ru: "–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ" },
            { en: "Odors in fridge", ru: "–ó–∞–ø–∞—Ö–∏ –≤–Ω—É—Ç—Ä–∏" },
            { en: "Food freezing", ru: "–ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç—ã" },
            { en: "Water dispenser failure", ru: "–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞–∑–¥–∞—Ç—á–∏–∫ –≤–æ–¥—ã" },
            { en: "Control panel unresponsive", ru: "–ü–∞–Ω–µ–ª—å –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç" },
            { en: "Door not closing", ru: "–î–≤–µ—Ä—å –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è" },
            { en: "Evaporator fan noise", ru: "–®—É–º –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ –∏—Å–ø–∞—Ä–∏—Ç–µ–ª—è" }
        ],
        diagnosis: [
            { en: "Faulty compressor", ru: "–ù–µ–∏—Å–ø—Ä–∞–≤–Ω—ã–π –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä" },
            { en: "Refrigerant leak", ru: "–£—Ç–µ—á–∫–∞ —Ö–ª–∞–¥–∞–≥–µ–Ω—Ç–∞" },
            { en: "Defrost timer failure", ru: "–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω —Ç–∞–π–º–µ—Ä —Ä–∞–∑–º–æ—Ä–æ–∑–∫–∏" },
            { en: "Clogged drain", ru: "–ó–∞—Å–æ—Ä –¥—Ä–µ–Ω–∞–∂–∞" },
            { en: "Broken fan motor", ru: "–°–ª–æ–º–∞–Ω –º–æ—Ç–æ—Ä –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞" }
        ],
        actions: [
            { en: "Replaced compressor", ru: "–ó–∞–º–µ–Ω–µ–Ω –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä" },
            { en: "Repaired leak + refill", ru: "–ó–∞–ø—Ä–∞–≤–ª–µ–Ω —Ñ—Ä–µ–æ–Ω, —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞ —É—Ç–µ—á–∫–∞" },
            { en: "Cleared drain", ru: "–ü—Ä–æ–≤–µ–¥–µ–Ω –ø—Ä–æ—á–∏—Å—Ç–∫–∞ –¥—Ä–µ–Ω–∞–∂–∞" },
            { en: "Installed new fan", ru: "–ó–∞–º–µ–Ω–µ–Ω –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä" },
            { en: "Replaced door gasket", ru: "–ó–∞–º–µ–Ω–∏–ª–∏ —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª—å –¥–≤–µ—Ä–∏" }
        ]
    },
    dishwasher: {
        brands: ['GE','Samsung','Whirlpool','LG','Kenmore','Bosch','Siemens','Electrolux','Beko','Miele','Hotpoint','Indesit','Ariston','Zanussi','Candy','Sharp','Viking','Daewoo','Smeg'],
        problems: [
            { en: "Not draining water", ru: "–ù–µ —Å–ª–∏–≤–∞–µ—Ç –≤–æ–¥—É" },
            { en: "Dishes not getting clean", ru: "–ü–æ—Å—É–¥–∞ –Ω–µ –æ—Ç–º—ã–≤–∞–µ—Ç—Å—è" },
            { en: "Leaking", ru: "–¢–µ—á–µ—Ç" },
            { en: "No power", ru: "–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è" },
            { en: "Filling with water continuously", ru: "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ –Ω–∞–±–∏—Ä–∞–µ—Ç –≤–æ–¥—É" },
            { en: "Door not latching", ru: "–î–≤–µ—Ä—å –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è" }
        ],
        diagnosis: [
            {en:"Clogged drain hose",ru:"–ó–∞–±–∏—Ç —Å–ª–∏–≤–Ω–æ–π —à–ª–∞–Ω–≥"},
            {en:"Defective drain pump",ru:"–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω —Å–ª–∏–≤–Ω–æ–π –Ω–∞—Å–æ—Å"},
            {en:"Broken door switch",ru:"–î–∞—Ç—á–∏–∫ –¥–≤–µ—Ä–∏ –Ω–µ–∏—Å–ø—Ä–∞–≤–µ–Ω"},
            {en:"Blocked spray arms",ru:"–ó–∞—Å–æ—Ä —Ä–∞—Å–ø—ã–ª–∏—Ç–µ–ª–µ–π"}
        ],
        actions: [
            {en:"Cleaned hose",ru:"–ü—Ä–æ–º—ã–ª–∏ —à–ª–∞–Ω–≥"},
            {en:"Replaced pump",ru:"–ü–æ–º–µ–Ω—è–Ω –Ω–∞—Å–æ—Å"},
            {en:"Replaced latch",ru:"–ü–æ–º–µ–Ω—è–ª–∏ –∑–∞–º–æ–∫"},
            {en:"Fixed spray arms",ru:"–û—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Ä–∞—Å–ø—ã–ª–∏—Ç–µ–ª—å"}
        ]
    },
    washing_machine: {
        brands: ['LG','Samsung','Whirlpool','Bosch','Electrolux','Indesit','Hotpoint','Candy','Beko','Zanussi', 'Ardo','Siemens','Miele','AEG','Ariston','Vestfrost','Haier','Daewoo','Sharp','Panasonic'],
        problems:[
            {en:"Won't start", ru:"–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è"},
            {en:"Water leaks", ru:"–¢–µ—á–µ—Ç"},
            {en:"Not spinning", ru:"–ù–µ –∫—Ä—É—Ç–∏—Ç"},
            {en:"No water intake", ru:"–ù–µ—Ç –Ω–∞–±–æ—Ä–∞ –≤–æ–¥—ã"},
            {en:"Jumps/vibrates", ru:"–ü—Ä—ã–≥–∞–µ—Ç/–≤–∏–±—Ä–∏—Ä—É–µ—Ç"},
            {en:"Doesn't heat", ru:"–ù–µ –≥—Ä–µ–µ—Ç"},
            {en:"Stains on laundry", ru:"–ü—è—Ç–Ω–∞ –Ω–∞ –±–µ–ª—å–µ"},
            {en:"Controller error", ru:"–û—à–∏–±–∫–∞ –Ω–∞ –ø–∞–Ω–µ–ª–∏"}
        ],
        diagnosis:[
            {en:"Pump motor fails", ru:"–°–ª–æ–º–∞–Ω –º–æ—Ç–æ—Ä –Ω–∞—Å–æ—Å–∞"},
            {en:"Drive belt snapped", ru:"–ü–æ—Ä–≤–∞–ª—Å—è —Ä–µ–º–µ–Ω—å"},
            {en:"Shock absorbers broken", ru:"–ò–∑–Ω–æ—Å –∞–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä–∞"},
            {en:"Heating element burnt", ru:"–°–≥–æ—Ä–µ–ª —Ç–µ–Ω"},
            {en:"Door interlock fault", ru:"–ë–ª–æ–∫–∏—Ä–∞—Ç–æ—Ä –¥–≤–µ—Ä–∏"}
        ],
        actions:[
            {en:"Replaced bearing", ru:"–ó–∞–º–µ–Ω–µ–Ω –ø–æ–¥—à–∏–ø–Ω–∏–∫"},
            {en:"Reinstalled drive belt", ru:"–ù–æ–≤—ã–π —Ä–µ–º–µ–Ω—å"},
            {en:"Fixed pump", ru:"–ü–æ—á–∏–Ω–∏–ª–∏ –Ω–∞—Å–æ—Å"},
            {en:"Mounted new shock absorber", ru:"–ü–æ—Å—Ç–∞–≤–∏–ª–∏ –∞–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä"},
            {en:"Changed heating element", ru:"–°–º–µ–Ω–∏–ª–∏ —Ç–µ–Ω"}
        ]
    },
    dryer: {
        brands: ["LG","Samsung","Whirlpool","Bosch","Electrolux","Hotpoint","Indesit","Maytag","AEG","Beko","Siemens","Miele","Candy","Sharp","Panasonic","Ariston","Zanussi","Haier","Ardo","Daewoo"],
        problems:[
            {en:"Not heating",ru:"–ù–µ –≥—Ä–µ–µ—Ç"},
            {en:"Does not start",ru:"–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è"},
            {en:"Drum not turning",ru:"–ë–∞—Ä–∞–±–∞–Ω –Ω–µ –∫—Ä—É—Ç–∏—Ç—Å—è"},
            {en:"Unusual noise",ru:"–°—Ç—Ä–∞–Ω–Ω—ã–π —à—É–º"},
            {en:"Stops mid-cycle",ru:"–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ"},
            {en:"Door won‚Äôt close",ru:"–î–≤–µ—Ä—å –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è"}
        ],
        diagnosis:[
            {en:"Blown thermal fuse",ru:"–°–≥–æ—Ä–µ–ª —Ç–µ—Ä–º–æ–ø—Ä–µ–¥"},
            {en:"Broken drive belt",ru:"–†–µ–º–µ–Ω—å –ø–æ—Ä–≤–∞–ª—Å—è"},
            {en:"Clogged venting",ru:"–ó–∞–±–∏—Ç—ã –≤–æ–∑–¥—É—Ö–æ–≤–æ–¥—ã"},
            {en:"Defective door switch",ru:"–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω –¥–∞—Ç—á–∏–∫ –¥–≤–µ—Ä–∏"}
        ],
        actions:[
            {en:"Replaced thermal fuse",ru:"–ü–æ–º–µ–Ω—è–ª–∏ —Ç–µ—Ä–º–æ–ø—Ä–µ–¥"},
            {en:"New drive belt installed",ru:"–ü–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ä–µ–º–µ–Ω—å"},
            {en:"Cleaned vent",ru:"–ü–æ—á–∏—â–µ–Ω –∫–∞–Ω–∞–ª"},
            {en:"Changed door switch",ru:"–ü–æ–º–µ–Ω—è–ª–∏ –¥–∞—Ç—á–∏–∫ –¥–≤–µ—Ä–∏"}
        ]
    },
    stove_oven: {
        brands: ["GE","Whirlpool","Bosch","Samsung","Electrolux","Beko","Hotpoint","Indesit","Zanussi","Ariston","Gorenje","Miele","Candy","Siemens","Sharp","Smeg","Panasonic","Vestfrost","Hansa","AEG"],
        problems:[
            {en:"No heating",ru:"–ù–µ—Ç –Ω–∞–≥—Ä–µ–≤–∞"},
            {en:"Burners not igniting",ru:"–ù–µ –∑–∞–∂–∏–≥–∞—é—Ç—Å—è –≥–æ—Ä–µ–ª–∫–∏"},
            {en:"Oven not baking evenly",ru:"–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –≤—ã–ø–µ—á–∫–∞"},
            {en:"Door does not seal",ru:"–î–≤–µ—Ä—Ü–∞ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è"},
            {en:"Knobs loose",ru:"–ö—Ä—É—Ç–∏–ª–∫–∏ –ª—é—Ñ—Ç—è—Ç"}
        ],
        diagnosis:[
            {en:"Faulty igniter",ru:"–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω –≤–æ—Å–ø–ª–∞–º–µ–Ω–∏—Ç–µ–ª—å"},
            {en:"Defective thermostat",ru:"–ü–ª–æ—Ö–æ–π —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç"},
            {en:"Heating element burnt",ru:"–°–≥–æ—Ä–µ–ª —Ç–µ–Ω"},
            {en:"Broken door hinge",ru:"–ü–µ—Ç–ª—è —Å–ª–æ–º–∞–Ω–∞"}
        ],
        actions:[
            {en:"Replaced igniter",ru:"–ó–∞–º–µ–Ω–∞ –≤–æ—Å–ø–ª–∞–º–µ–Ω–∏—Ç–µ–ª—è"},
            {en:"Fixed thermostat",ru:"–¢–µ—Ä–º–æ—Å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–∏–ª–∏"},
            {en:"Replaced heater",ru:"–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–µ–Ω"},
            {en:"Rehung door",ru:"–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –¥–≤–µ—Ä—å"}
        ]
    },
    microwave: {
        brands:["Samsung","LG","Panasonic","Sharp","Whirlpool","Bosch","Beko","Hotpoint","Candy","Midea","Daewoo","Siemens","Electrolux","Zanussi","Toshiba","Gorenje","Vestfrost","Ardo","Smeg","Mystery"],
        problems:[
            {en:"No heating",ru:"–ù–µ –≥—Ä–µ–µ—Ç"},
            {en:"Sparking inside",ru:"–ò—Å–∫—Ä–∏—Ç"},
            {en:"Turntable not rotating",ru:"–¢–∞—Ä–µ–ª–∫–∞ –Ω–µ –∫—Ä—É—Ç–∏—Ç—Å—è"},
            {en:"Buttons not working",ru:"–ö–Ω–æ–ø–∫–∏ –Ω–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç"},
            {en:"Loud noise",ru:"–ì—Ä–æ–º–∫–æ —Ä–∞–±–æ—Ç–∞–µ—Ç"}
        ],
        diagnosis:[
            {en:"Magnetron failure",ru:"–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω –º–∞–≥–Ω–µ—Ç—Ä–æ–Ω"},
            {en:"Faulty door switch",ru:"–ü—Ä–æ–±–ª–µ–º–∞ –¥–≤–µ—Ä–∏"},
            {en:"Broken turntable motor",ru:"–ú–æ—Ç–æ—Ä —Ç–∞—Ä–µ–ª–∫–∏ —Å–ª–æ–º–∞–Ω"}
        ],
        actions:[
            {en:"Replaced magnetron",ru:"–ü–æ–º–µ–Ω—è–ª–∏ –º–∞–≥–Ω–µ—Ç—Ä–æ–Ω"},
            {en:"Changed door switch",ru:"–î–∞—Ç—á–∏–∫ –¥–≤–µ—Ä–∏"},
            {en:"New turntable motor",ru:"–ü–æ—Å—Ç–∞–≤–∏–ª–∏ –º–æ—Ç–æ—Ä —Ç–∞—Ä–µ–ª–∫–∏"}
        ]
    }
};

const STATUS_LIST = [
    { val:"", en:"Select Status", ru:"–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å" },
    { val:"completed", en:"‚úÖ Fixed 100%", ru:"‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ" },
    { val:"waiting", en:"‚è≥ Waiting for Part", ru:"‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—á–∞—Å—Ç–∏" },
    { val:"temporary", en:"üîß Temporary Fix", ru:"üîß –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ" },
    { val:"unrepairable", en:"‚ùå Not Repairable", ru:"‚ùå –ù–µ –ø–æ–¥–ª–µ–∂–∏—Ç —Ä–µ–º–æ–Ω—Ç—É" }
];

const ENGLISH_UI = {
    applianceType: "Appliance Type",
    brand: "Brand",
    model: "Model",
    serial: "Serial Number",
    year: "Year of Manufacture",
    month: "Month",
    problem: "Problem",
    diagnosis: "Diagnosis",
    action: "Action Taken",
    status: "Status",
    notes: "Additional Notes",
    selectBrand: "Select Brand",
    selectProblem: "Select Problem",
    selectDiagnosis: "Select Diagnosis",
    selectAction: "Select Action",
    selectStatus: "Select Status",
    formPlaceholderModel: "Enter model number",
    formPlaceholderSerial: "Enter serial number",
    formPlaceholderYear: "YYYY",
    formPlaceholderMonth: "MM",
    formPlaceholderNotes: "Enter any additional details or recommendations...",
    btnGenerateReport: "üìã Generate Report",
    btnClearForm: "üóëÔ∏è Clear Form",
    btnCopyAll: "üìë Copy All Reports",
    btnCopyLast: "üìã Copy Last Report",
    btnClearAll: "üóëÔ∏è Clear All Reports",
    sectionAppliance: "üè† Appliance Information",
    sectionService: "üîç Service Details",
    reportTitle: "üìÑ Service Report",
    customerTemplates: "üí¨ Customer Message Templates"
};

const LOCAL_KEY_PROBLEM_DIAGNOSIS = "additionalProblemsAndDiagnosisV2";

function getAdditions() {
    try { return JSON.parse(localStorage.getItem(LOCAL_KEY_PROBLEM_DIAGNOSIS) || "{}"); }
    catch { return {}; }
}
function setAdditions(data) { localStorage.setItem(LOCAL_KEY_PROBLEM_DIAGNOSIS, JSON.stringify(data)); }
function isClientMode() {
    return document.querySelector('.mode-btn[data-mode="client"]').classList.contains('active');
}

// ================= STARTUP! FILL SELECTS =================
function fillSelects(clientMode) {
    // 1. Appliance type
    const catSel = document.getElementById("category");
    catSel.innerHTML = "";
    catSel.appendChild(new Option("Select Appliance Type", ""));
    Object.entries(applianceData).forEach(([cat, obj]) => {
        let label = obj.applianceName ? obj.applianceName : cat.replace(/_/g,' ').replace(/\b\w/g,x=>x.toUpperCase());
        if (!clientMode && obj && obj.ruName) label += " / "+obj.ruName;
        let e = new Option(label,cat);
        catSel.appendChild(e);
    });

    const brands = (catSel.value&&applianceData[catSel.value] ? applianceData[catSel.value].brands : []);
    const brandSel = document.getElementById("brand");
    brandSel.innerHTML = `<option value="">${ENGLISH_UI.selectBrand}</option>`;
    brands.forEach(brand=>{
        brandSel.appendChild(new Option(brand,brand));
    });

    fillAllOptionBlocks(clientMode);
}

function fillAllOptionBlocks(clientMode) {
    ["problem","diagnosis","action"].forEach(type=>{
        fillOptions(type, clientMode);
        renderCustomList(type, clientMode);
    });
    fillStatus(clientMode);
};

function fillOptions(type, clientMode) {
    const cat = document.getElementById("category").value;
    const sel = document.getElementById(type);
    sel.innerHTML = `<option value="">${ENGLISH_UI["select"+type.charAt(0).toUpperCase()+type.slice(1)]||"Select"}</option>`;
    if (!cat || !applianceData[cat]) return;
    let arr = applianceData[cat][type] || [];
    const additions = getAdditions();
    let customs = (additions[cat]&&additions[cat][type]) ? additions[cat][type] : [];
    arr = arr.concat(customs);

    arr.forEach(item=>{
        sel.appendChild(new Option(clientMode?item.en:(item.en+(item.ru?(" / "+item.ru):"")), item.en));
    });
}

function fillStatus(clientMode) {
    let sel = document.getElementById("status");
    sel.innerHTML = "";
    STATUS_LIST.forEach(st=>{
        sel.appendChild(new Option((clientMode?st.en:st.en+" / "+st.ru), st.val));
    });
}

// ========== ADD/REMOVE CUSTOM. + UI RENDER LIST ============
function renderCustomList(type, clientMode) {
    const cat = document.getElementById("category").value;
    const ul = document.getElementById(type+'-custom-list');
    ul.innerHTML = "";
    if (!cat) return;
    const additions = getAdditions();
    let customs = (additions[cat] && additions[cat][type]) ? additions[cat][type] : [];
    customs.forEach((item,i)=>{
        let li = document.createElement("li");
        li.className = "custom-choice";
        let label = document.createElement("span");
        label.className = "custom-item-label";
        label.textContent = clientMode ? item.en : (item.en + (item.ru?(" / "+item.ru):""));
        li.appendChild(label);
        let delBtn = document.createElement("button");
        delBtn.className = "trash-btn";
        delBtn.title = "Delete";
        delBtn.type = "button";
        delBtn.innerHTML = "üóë";
        delBtn.onclick = function(){
            if (!confirm("Delete this?")) return;
            customs.splice(i,1);
            additions[cat][type]=customs;
            setAdditions(additions);
            renderCustomList(type, clientMode);
            fillOptions(type, clientMode);
        };
        li.appendChild(delBtn);
        ul.appendChild(li);
    });
}

function handlePlusAddBtn(type) {
    const cat = document.getElementById("category").value;
    if (!cat) { alert("Select Appliance Type first!"); return; }
    let en = prompt("Enter new "+type.charAt(0).toUpperCase()+type.slice(1)+" (English):");
    if (!en || !en.trim()) return;
    let ru = isClientMode() ? "" : prompt("Enter translation (Russian):", "");
    en = en.trim();
    ru = ru?ru.trim():"";
    // For uniqueness: prevent dups
    const additions = getAdditions();
    const arrBase = (applianceData[cat][type] || []).concat((additions[cat]&&additions[cat][type]) ? additions[cat][type] : []);
    if (arrBase.some(x=>x.en.toLowerCase()===en.toLowerCase())) { alert("Already exists!"); return; }
    if (!additions[cat]) additions[cat]={};
    if (!additions[cat][type]) additions[cat][type]=[];
    additions[cat][type].push({en,ru});
    setAdditions(additions);
    renderCustomList(type, isClientMode());
    fillOptions(type, isClientMode());
}

// =================== REPORT ======================
let reportsArr = [];
function saveReports() { localStorage.setItem('applianceReports', JSON.stringify(reportsArr)); }
function loadReports() { try{reportsArr=JSON.parse(localStorage.getItem('applianceReports')||"[]");}catch{reportsArr=[];} }
function renderAllReports() {
    let allReportsBlock = document.getElementById('allReportsBlock');
    let reportOutput = document.getElementById('reportsControlBtns');
    if (reportsArr.length === 0) {
        allReportsBlock.innerHTML = '';
        reportOutput.classList.add('hidden'); return;
    }
    let out = '';
    reportsArr.forEach((r,idx) => {
        out += `<div class="report-output" style="margin-top:24px;">
            <div class="report-title">${ENGLISH_UI.reportTitle}</div>
            <div class="report-content">
                <div class="report-line"><span class="report-label">${ENGLISH_UI.applianceType}:</span> <span class="report-value">${r.appliance}</span></div>
                <div class="report-line"><span class="report-label">${ENGLISH_UI.brand}:</span> <span class="report-value">${r.brand}</span></div>
                <div class="report-line"><span class="report-label">${ENGLISH_UI.model}:</span> <span class="report-value">${r.model}</span></div>
                <div class="report-line"><span class="report-label">${ENGLISH_UI.serial}:</span> <span class="report-value">${r.serial}</span></div>
                <div class="report-line"><span class="report-label">${ENGLISH_UI.year}:</span> <span class="report-value">${r.year}${r.month?', month: '+r.month.padStart(2,'0'):""}</span></div>
                <div class="report-line"><span class="report-label">${ENGLISH_UI.problem}:</span> <span class="report-value">${r.problem}</span></div>
                <div class="report-line"><span class="report-label">${ENGLISH_UI.diagnosis}:</span> <span class="report-value">${r.diagnosis}</span></div>
                <div class="report-line"><span class="report-label">${ENGLISH_UI.action}:</span> <span class="report-value">${r.action}</span></div>
                <div class="report-line"><span class="report-label">${ENGLISH_UI.status}:</span> <span class="report-value">${r.status}</span></div>
                <div class="report-line"><span class="report-label">${ENGLISH_UI.notes}:</span> <span class="report-value">${r.notes}</span></div>
            </div>
        </div>`;
    });
    allReportsBlock.innerHTML = out;
    reportOutput.classList.remove('hidden');
}
function reportToText(r) {
    return `[${r.appliance}]
Brand: ${r.brand}
Model: ${r.model}
Serial#: ${r.serial}
Year: ${r.year}${r.month?", Month: "+r.month.padStart(2,"0"):""}
Problem: ${r.problem}
Diagnosis: ${r.diagnosis}
Action: ${r.action}
Status: ${r.status}
Notes: ${r.notes}`.trim();
};

function getFormVals() {
    return {
        appliance: document.getElementById('category').options[document.getElementById('category').selectedIndex].text,
        brand: document.getElementById('brand').options[document.getElementById('brand').selectedIndex]?.text || '',
        model: document.getElementById('model').value.trim(),
        serial: document.getElementById('serial').value.trim(),
        year: document.getElementById('year').value.trim(),
        month: (document.getElementById('month').value||"").trim(),
        problem: document.getElementById('problem').options[document.getElementById('problem').selectedIndex]?.text || '',
        diagnosis: document.getElementById('diagnosis').options[document.getElementById('diagnosis').selectedIndex]?.text || '',
        action: document.getElementById('action').options[document.getElementById('action').selectedIndex]?.text || '',
        status: document.getElementById('status').options[document.getElementById('status').selectedIndex]?.text || '',
        notes: document.getElementById('notes').value.trim()
    }
}
// =========== EVENTS ============
function resetForm() {
    document.getElementById('repairForm').reset();
    fillSelects(isClientMode());
    fillAllOptionBlocks(isClientMode());
}

document.getElementById('category').addEventListener('change',()=>{fillAllOptionBlocks(isClientMode());});

document.querySelectorAll('.plus-add-btn').forEach(btn=>{
    btn.onclick = ()=>handlePlusAddBtn(btn.dataset.add);
});
form.addEventListener('submit', e => {
    e.preventDefault();
    const vals = getFormVals();
    reportsArr.push(vals);
    saveReports();
    renderAllReports();
    resetForm();
});
document.getElementById('clearBtn').addEventListener('click', resetForm);
document.getElementById('copyAllBtn').addEventListener('click',()=>{if(reportsArr.length)navigator.clipboard.writeText(reportsArr.map(reportToText).join('\n\n====\n\n'));});
document.getElementById('copyLastBtn').addEventListener('click',()=>{if(reportsArr.length)navigator.clipboard.writeText(reportToText(reportsArr[reportsArr.length-1]));});
document.getElementById('clearAllBtn').addEventListener('click',()=>{reportsArr.length=0;saveReports();renderAllReports();});

document.querySelectorAll('.mode-btn').forEach(button=>{
    button.addEventListener('click',()=>{
        document.querySelectorAll('.mode-btn').forEach(btn=>btn.classList.remove('active'));
        button.classList.add('active');
        switchUiLang(isClientMode());
    })
});

function switchUiLang(client) {
    // –õ–µ–π–±–ª—ã, –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã, —à–∞–ø–∫–∏ —Å–µ–∫—Ü–∏–π, —à–∞–±–ª–æ–Ω—ã
    document.querySelectorAll('.label').forEach(label => {
        label.childNodes[0].nodeValue = ENGLISH_UI[(label.textContent||"").toLowerCase().replace(/[^a-z]+/gi,'') ]|| label.childNodes[0].nodeValue;
    });
    document.querySelectorAll('.translation').forEach(span=>!client?span.classList.remove('hidden'):span.classList.add('hidden'));
    document.getElementById('model').placeholder=ENGLISH_UI.formPlaceholderModel;
    document.getElementById('serial').placeholder=ENGLISH_UI.formPlaceholderSerial;
    document.getElementById('year').placeholder=ENGLISH_UI.formPlaceholderYear;
    document.getElementById('month').placeholder=ENGLISH_UI.formPlaceholderMonth;
    document.getElementById('notes').placeholder=ENGLISH_UI.formPlaceholderNotes;
    document.querySelector('button[type="submit"]').textContent=ENGLISH_UI.btnGenerateReport;
    document.getElementById('clearBtn').textContent=ENGLISH_UI.btnClearForm;
    document.getElementById('copyAllBtn').textContent=ENGLISH_UI.btnCopyAll;
    document.getElementById('copyLastBtn').textContent=ENGLISH_UI.btnCopyLast;
    document.getElementById('clearAllBtn').textContent=ENGLISH_UI.btnClearAll;
    document.querySelector('.templates-title').textContent=ENGLISH_UI.customerTemplates;
    document.querySelectorAll('.section-title')[0].textContent=ENGLISH_UI.sectionAppliance;
    document.querySelectorAll('.section-title')[1].textContent=ENGLISH_UI.sectionService;
    fillSelects(client);
    fillAllOptionBlocks(client);
}
// === CUSTOM LIST INIT === (force on first draw)
document.querySelectorAll('.template-btn').forEach(btn=>{
    btn.addEventListener('click',()=> {
        document.getElementById('notes').value = btn.querySelector('.template-main').textContent;
    });
});
loadReports();
renderAllReports();
fillSelects(false);
fillAllOptionBlocks(false);
switchUiLang(isClientMode());
</script>
</body>
</html>
