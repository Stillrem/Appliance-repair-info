<!--
  ---- PART 1/4 START ----
  –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∫–∞–∫ report.html. –ü–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —á–∞—Å—Ç–∏ (Part 4) –≤—Å—ë –æ–±—ä–µ–¥–∏–Ω–∏—Ç–µ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª!
-->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–û—Ç—á–µ—Ç –ø–æ —Ä–µ–º–æ–Ω—Ç—É —Ç–µ—Ö–Ω–∏–∫–∏ | Repair Report</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    html,body {
      background:#f7fafc; min-height:100%; font-family:system-ui,sans-serif;
      margin:0; padding:0; color:#222;
    }
    .main { max-width:820px; margin:24px auto; background:#fff; border-radius:12px; box-shadow:0 6px 24px #0001; padding:32px 20px 24px; }
    h1, h2 { margin-top:0; }
    .mode-row { display:flex; justify-content:flex-end; margin-bottom:8px;}
    .mode-row label { font-weight:bold; margin-left:4px;}
    .form-row { display:grid; grid-template-columns:1fr 1fr; gap:22px; margin-bottom:17px;}
    .form-row .col-span { grid-column:1/-1;}
    label { font-size:15px; color:#444;}
    select, input, textarea { font:inherit; border:1.2px solid #c3d0e0; border-radius:4px; padding:7px 8px; outline:none;}
    select:focus, input:focus, textarea:focus { border-color:#3179e6; }
    textarea {resize:vertical;min-height:62px;}
    .cat-inline {display:flex;gap:8px;align-items:center;}
    .add-btn, .del-btn, .copy-btn, .clear-btn, .report-btn {
      background:#3179e6; color:#fff; border:none; padding:5px 13px; border-radius:4px; font-size:13.5px; cursor:pointer; margin-left:8px;transition:.12s;
    }
    .add-btn {background:#1bb93c;}
    .del-btn {background:#ed5a5a;}
    .report-btn {font-weight:bold;background:#f4b812;color:#222;}
    .add-btn:hover, .del-btn:hover, .copy-btn:hover, .clear-btn:hover, .report-btn:hover {filter:brightness(1.07);}
    .field-list {margin-top:6px;}
    .field-list .custom-item { background:#f9ede0; border-radius:3px; padding:2px 7px; margin:0 6px 3px 0; display:inline-block; font-size:14px;}
    .field-list .del-btn {padding:0 7px; margin:0 0 0 4px;}
    .template-area {margin:11px 0 0;}
    .template-label {font-size:14px; margin-bottom:3px;}
    .history-block {margin-top:34px; padding:20px 18px 7px; background:#f2f5fa; border-radius:8px;}
    .report-item {background:#fff; border:1px solid #dae6f4; border-radius:7px; margin:10px 0; padding:10px 12px;position:relative;}
    .report-actions {position:absolute; right:16px; top:10px; display:flex; gap:7px;}
    .foot-note {color:#6a879b; font-size:15px; margin:14px 3px 0;}
    .status-row, .labels-row {display:flex; gap:18px; margin-bottom:10px;}
    .status-row select, .labels-row select {min-width:135px;}
    .small-btn {font-size:12.5px; padding:1px 7px; margin:0;}
    @media(max-width:720px){
      .main{padding:14px 3px;}
      .form-row{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="main">
    <div class="mode-row">
      <label>
        <input type="checkbox" id="modeClient" />
        <span id="modeLabel">–†–µ–∂–∏–º: –¢–µ—Ö–Ω–∏–∫</span>
      </label>
    </div>
    <h1 id="mainTitle">–û—Ç—á–µ—Ç –ø–æ —Ä–µ–º–æ–Ω—Ç—É —Ç–µ—Ö–Ω–∏–∫–∏</h1>
    <form id="repairForm" autocomplete="off">
      <div class="form-row">
        <div>
          <label id="catLabel" for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–µ—Ö–Ω–∏–∫–∏</label>
          <div class="cat-inline">
            <select id="category"></select>
            <button type="button" class="add-btn small-btn" id="addCategoryBtn" title="–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">+ Add</button>
          </div>
          <div class="field-list" id="categoryList"></div>
        </div>
        <div>
          <label id="brandLabel" for="brand">–ë—Ä–µ–Ω–¥</label>
          <div class="cat-inline">
            <select id="brand"></select>
            <button type="button" class="add-btn small-btn" id="addBrandBtn">+ Add</button>
          </div>
          <div class="field-list" id="brandList"></div>
        </div>
        <div>
          <label id="modelLabel" for="model">–ú–æ–¥–µ–ª—å</label>
          <input id="model" name="model" type="text" maxlength="60" required>
        </div>
        <div>
          <label id="serialLabel" for="serial">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</label>
          <input id="serial" name="serial" type="text" maxlength="58">
        </div>
        <div>
          <label for="releaseMonth" id="releaseMonthLabel">–ú–µ—Å—è—Ü –≤—ã–ø—É—Å–∫–∞</label>
          <select id="releaseMonth"></select>
        </div>
        <div>
          <label for="releaseYear" id="releaseYearLabel">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</label>
          <select id="releaseYear"></select>
        </div>
      </div>

      <div class="form-row">
        <div class="col-span">
          <label id="problemLabel" for="problem">–ü—Ä–æ–±–ª–µ–º–∞</label>
          <div class="cat-inline">
            <select id="problem"></select>
            <button type="button" class="add-btn small-btn" id="addProblemBtn">+ Add</button>
          </div>
          <div class="field-list" id="problemList"></div>
        </div>
      </div>
      <div class="form-row">
        <div>
          <label id="diagLabel" for="diagnosis">–î–∏–∞–≥–Ω–æ–∑</label>
          <div class="cat-inline">
            <select id="diagnosis"></select>
            <button type="button" class="add-btn small-btn" id="addDiagnosisBtn">+ Add</button>
          </div>
          <div class="field-list" id="diagnosisList"></div>
        </div>
        <div>
          <label id="actionsLabel" for="actions">–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ</label>
          <div class="cat-inline">
            <select id="actions"></select>
            <button type="button" class="add-btn small-btn" id="addActionsBtn">+ Add</button>
          </div>
          <div class="field-list" id="actionsList"></div>
        </div>
      </div>
      <div class="form-row">
        <div>
          <label id="priceLabel" for="price">–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞ (‚ÇΩ)</label>
          <input id="price" name="price" type="number" min="0" max="500000" step="1" required>
        </div>
        <div>
          <label id="statusLabel" for="status">–°—Ç–∞—Ç—É—Å</label>
          <select id="status">
            <option>–ì–æ—Ç–æ–≤–æ</option>
            <option>–í —Ä–∞–±–æ—Ç–µ</option>
            <option>–û–∂–∏–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
            <option>–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–∏–∑–∏—Ç</option>
            <option>–û–∂–∏–¥–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="col-span">
          <label id="notesLabel" for="notes">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ / –ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
          <textarea id="notes" maxlength="800"></textarea>
        </div>
      </div>
      <div class="form-row">
        <button type="submit" class="report-btn" id="makeReportBtn">–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç</button>
        <button type="button" class="clear-btn" id="clearFormBtn">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
      </div>
    </form>

    <div class="template-area">
      <div class="template-label" id="templateTitle">–®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É:</div>
      <textarea id="templateOutput" readonly></textarea>
      <button class="copy-btn" id="copyTemplateBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω</button>
    </div>
    <div class="history-block">
      <b id="historyTitle">–ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤ (localStorage):</b>
      <div id="reportsArea"></div>
      <button class="small-btn copy-btn" id="copyAllBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ</button>
      <button class="small-btn clear-btn" id="clearHistoryBtn">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
    </div>
    <div class="foot-note" id="footNote">
      –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —É –≤–∞—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–∏–∫–∞–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
    </div>
  </div>
<script>
/* ---- PART 1/4 END ---- */
</script>

      <script>
/* ---- PART 2/4 START ---- */

/** ‚Äî‚Äî‚Äî –Ø–∑—ã–∫–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏ –º–∞—Å—Å–∏–≤—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–∏ ‚Äî‚Äî‚Äî **/

const i18n = {
  ru: {
    modeTech:    "–†–µ–∂–∏–º: –¢–µ—Ö–Ω–∏–∫",
    modeClient:  "–†–µ–∂–∏–º: –ö–ª–∏–µ–Ω—Ç",
    mainTitle:   "–û—Ç—á–µ—Ç –ø–æ —Ä–µ–º–æ–Ω—Ç—É —Ç–µ—Ö–Ω–∏–∫–∏",
    category:    "–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–µ—Ö–Ω–∏–∫–∏",
    brand:       "–ë—Ä–µ–Ω–¥",
    model:       "–ú–æ–¥–µ–ª—å",
    serial:      "–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä",
    problem:     "–ü—Ä–æ–±–ª–µ–º–∞",
    diagnosis:   "–î–∏–∞–≥–Ω–æ–∑",
    actions:     "–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ",
    price:       "–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞ (‚ÇΩ)",
    month:       "–ú–µ—Å—è—Ü –≤—ã–ø—É—Å–∫–∞",
    year:        "–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞",
    status:      "–°—Ç–∞—Ç—É—Å",
    notes:       "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ / –ü—Ä–∏–º–µ—á–∞–Ω–∏—è",
    reportBtn:   "–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç",
    clear:       "–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É",
    templateTitle:"–®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É:",
    copy:        "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω",
    history:     "–ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤ (localStorage):",
    copyAll:     "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ",
    clearHistory:"–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é",
    footNote:    "–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —É –≤–∞—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–∏–∫–∞–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.",
    ready:       "–ì–æ—Ç–æ–≤–æ",
    wip:         "–í —Ä–∞–±–æ—Ç–µ",
    waitC:       "–û–∂–∏–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞",
    revisit:     "–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–∏–∑–∏—Ç",
    waitPart:    "–û–∂–∏–¥–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏",
    add:         "+ –î–æ–±–∞–≤–∏—Ç—å",
    del:         "–£–¥–∞–ª–∏—Ç—å"
  },
  en: {
    modeTech:    "Mode: Technician",
    modeClient:  "Mode: Client",
    mainTitle:   "Appliance Repair Report",
    category:    "Appliance Category",
    brand:       "Brand",
    model:       "Model",
    serial:      "Serial Number",
    problem:     "Problem",
    diagnosis:   "Diagnosis",
    actions:     "Performed Actions",
    price:       "Repair Price ($)",
    month:       "Release Month",
    year:        "Release Year",
    status:      "Status",
    notes:       "Comments / Notes",
    reportBtn:   "Create Report",
    clear:       "Clear Form",
    templateTitle:"Message template for client:",
    copy:        "Copy template",
    history:     "Report History (localStorage):",
    copyAll:     "Copy all",
    clearHistory:"Clear history",
    footNote:    "All data is saved only in your browser. Nothing is transferred to any server.",
    ready:       "Ready",
    wip:         "In Progress",
    waitC:       "Waiting for Client",
    revisit:     "Repeat Visit Needed",
    waitPart:    "Waiting for Part",
    add:         "+ Add",
    del:         "Delete"
  }
};

// !! –ë–æ–ª–µ–µ 50 –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π ‚Äî —Å–æ–∫—Ä. –ø—Ä–∏–º–µ—Ä—ã, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–ª—é –≤–µ—Å—å –º–∞—Å—Å–∏–≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏–ª–∏ –¥–∞–º –∫–æ–¥-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä

const categories = [
  { ru:"–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫", en:"Refrigerator" },
  { ru:"–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω–∞—è –º–∞—à–∏–Ω–∞", en:"Dishwasher" },
  { ru:"–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞", en:"Washing Machine" },
  { ru:"–°—É—à–∏–ª–∫–∞", en:"Dryer" },
  { ru:"–ü–ª–∏—Ç–∞/–î—É—Ö–æ–≤–∫–∞", en:"Range/Oven" },
  { ru:"–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞", en:"Microwave" }
];

// –¥–µ–º–æ-–±—Ä–µ–Ω–¥—ã: –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏–º–∏, –º–æ–∂–Ω–æ –≤ custom)
const brands = [
  "Samsung", "LG", "Bosch", "Siemens", "Whirlpool", "Electrolux", "Indesit", "Hotpoint", "Ariston",
  "Kenmore", "Frigidaire", "GE", "KitchenAid", "Maytag", "Panasonic", "Daewoo", "Beko", "Midea",
  "Haier", "AEG", "Sharp", "Candy", "Zanussi", "VESTEL", "Blomberg", "ASKO", "Hitachi", "Ardo", "Gorenje",
  // ...–µ—â—ë 20+
];

function bigProblemList(category) {
  // –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–≤–æ–∏ –±–æ–ª–µ–µ 50 –ø—É–Ω–∫—Ç–æ–≤ (—Ç—É—Ç –æ–∫–æ–ª–æ 10, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ)
  if (category.startsWith("–•–æ–ª–æ–¥") || category.startsWith("Refriger")) return [
    "–ù–µ —Ö–æ–ª–æ–¥–∏—Ç", "–ú–æ—Ä–æ–∑–∏—Ç —Å–ª–∞–±–æ", "–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è", "–®—É–º–∏—Ç –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä",
    "–ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä", "–ó–∞–≤–∏—Å–∞–µ—Ç –¥–∏—Å–ø–ª–µ–π", "–ú–∏–≥–∞–µ—Ç –æ—à–∏–±–∫–∞", "–¢–µ—á–µ—Ç –≤–æ–¥–∞", "–ò–Ω–µ–π –Ω–∞ —Å—Ç–µ–Ω–∫–µ", "–°–∏–ª—å–Ω–æ –≥—Ä–µ—é—Ç—Å—è —Å—Ç–µ–Ω–∫–∏",
    "–ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç—á–∏–∫–æ–º", "–ù–µ –≥–æ—Ä–∏—Ç —Å–≤–µ—Ç", "–ü–µ—Ä–µ–ø–∞–¥—ã —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã", "–ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∑–≤—É–∫–∏", "–í–æ–¥–∞ –≤ –º–æ—Ä–æ–∑–∏–ª–∫–µ",
    "–õ—ë–¥ –Ω–∞ —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–µ", "–°–ª–æ–º–∞–Ω –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä", "–ó–∞–ø–∞—Ö –≤–Ω—É—Ç—Ä–∏", "–°—Ç—É–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ", "–°–ª–æ–º–∞–Ω –¥–∏—Å–ø–ª–µ–π",
    // ...–¥–æ–±–∞–≤—å—Ç–µ 30+
  ];
  if (category.startsWith("–ü–æ—Å—É–¥") || category.startsWith("Dish")) return [
    "–ù–µ —Å–ª–∏–≤–∞–µ—Ç", "–ü–ª–æ—Ö–æ –º–æ–µ—Ç", "–ù–µ –Ω–∞–≥—Ä–µ–≤–∞–µ—Ç –≤–æ–¥—É", "–í–æ–¥–∞ –Ω–µ –∑–∞–ª–∏–≤–∞–µ—Ç—Å—è", "–ú–∏–≥–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä", "–ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–≤–µ—Ä—å", "–ü—Ä–æ—Ç–µ–∫–∞–µ—Ç", 
    "–ù–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫–∏","–ù–µ –≤—Ä–∞—â–∞—é—Ç—Å—è –∫–æ—Ä–æ–º—ã—Å–ª–∞","–ì—É–¥–∏—Ç –≤–æ –≤—Ä–µ–º—è —Ü–∏–∫–ª–∞","–ù–µ —Ä–∞—Å—Ç–≤–æ—Ä—è–µ—Ç—Å—è —Ç–∞–±–ª–µ—Ç–∫–∞",
    "–ü–ª–æ—Ö–æ–π —Å–ª–∏–≤", "–¶–∞—Ä–∞–ø–∏–Ω—ã –Ω–∞ –ø–æ—Å—É–¥–µ", "–ü–æ—Ö–æ–∂–µ —Ç–µ—á—å", "–ù–µ –æ—Ç–º—ã–≤–∞–µ—Ç –∂–∏—Ä", "–ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–ü–µ—Ä–µ–±–æ–∏ –≤ —Ä–∞–±–æ—Ç–µ",
    // ...+40
  ];
  if (category.startsWith("–°—Ç–∏—Ä–∞–ª") || category.startsWith("Washing")) return [
    "–ù–µ –Ω–∞–±–∏—Ä–∞–µ—Ç –≤–æ–¥—É", "–ù–µ –æ—Ç–∂–∏–º–∞–µ—Ç", "–í—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É", "–ì—É–¥–∏—Ç –Ω–∞—Å–æ—Å", "–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è", "–ù–µ –∫—Ä—É—Ç–∏—Ç—Å—è –±–∞—Ä–∞–±–∞–Ω", "–í–æ–¥–∞ –Ω–µ –Ω–∞–≥—Ä–µ–≤–∞–µ—Ç—Å—è",
    "–¢–µ—á—å –ø–æ –º–∞–Ω–∂–µ—Ç–µ", "–ë—å–µ—Ç —Ç–æ–∫–æ–º –∫–æ—Ä–ø—É—Å", "–®—É–º –ø—Ä–∏ –æ—Ç–∂–∏–º–µ", "–ü—Ä–∞–∑–¥–Ω—ã–π –∑–∞–ø—É—Å–∫", "–ü–æ—Ä–æ—à–æ–∫ –Ω–µ —Å–º—ã–≤–∞–µ—Ç—Å—è", "–ë–∞—Ä–∞–±–∞–Ω –Ω–µ –∫—Ä—É—Ç–∏—Ç—Å—è", "–ì—Ä—è–∑–Ω–∞—è –º–∞–Ω–∂–µ—Ç–∞",
    // ...+40
  ];
  if (category.startsWith("–°—É—à–∏") || category.startsWith("Dryer")) return [
    "–ù–µ —Å—É—à–∏—Ç", "–ü–µ—Ä–µ–≥—Ä–µ–≤–∞–µ—Ç—Å—è", "–ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è", "–û—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —Ü–∏–∫–ª", "–¢–µ—á–µ—Ç –≤–æ–¥–∞", "–ú–Ω–æ–≥–æ –≤–æ—Ä—Å–∞", "–®—É–º –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä", "–ü–ª–æ—Ö–æ —Å—É—à–∏—Ç –±–µ–ª—å–µ",
    "–ó–∞–ø–∞—Ö –≤–Ω—É—Ç—Ä–∏", "–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è", "–í–∫–ª—é—á–∞–µ—Ç—Å—è –∏ –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è", "–ù–µ –Ω–∞–≥—Ä–µ–≤–∞–µ—Ç—Å—è", "–û—à–∏–±–∫–∏ –Ω–∞ –¥–∏—Å–ø–ª–µ–µ", "–ì–æ—Ç–æ–≤–æ–µ –±–µ–ª—å–µ –≤–ª–∞–∂–Ω–æ–µ",
    // ...+40
  ];
  if (category.startsWith("–ü–ª–∏—Ç–∞") || category.startsWith("Range")) return [
    "–ù–µ –≥—Ä–µ–µ—Ç –∫–æ–Ω—Ñ–æ—Ä–∫–∞", "–ù–µ—Ç –∏—Å–∫—Ä—ã", "–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–ª–∏—Ç–∞", "–ì–∞–∑ –Ω–µ –ø–æ–¥–∞–µ—Ç—Å—è", "–ó–∞–≥–æ—Ä–µ–ª—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä", "–ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥—É—Ö–æ–≤–∫–∞",
    "–ì—Ä–µ–µ—Ç —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ", "–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∞–π–º–µ—Ä–æ–º", "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", "–ù–µ—Ç —ç–ª–µ–∫—Ç—Ä–æ–ø–æ–¥–∂–∏–≥–∞", "–ì–∞—Å–Ω—É—Ç –∫–æ–Ω—Ñ–æ—Ä–∫–∏", "–î—ã–º –∏–∑ –¥—É—Ö–æ–≤–∫–∏",
    // ...+40
  ];
  if (category.startsWith("–ú–∏–∫—Ä–æ") || category.startsWith("Micro")) return [
    "–ù–µ –≥—Ä–µ–µ—Ç", "–ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è", "–í—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É", "–ì—Ä–µ–µ—Ç—Å—è –∫–æ—Ä–ø—É—Å", "–ò—Å–∫—Ä–∏—Ç –≤–Ω—É—Ç—Ä–∏", "–ù–µ –∫—Ä—É—Ç–∏—Ç—Å—è —Ç–∞—Ä–µ–ª–∫–∞", "–î—ã–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ",
    "–®—É–º–∏—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä", "–î–≤–µ—Ä—Ü–∞ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è", "–¢—Ä–µ—Å–∫ –≤–Ω—É—Ç—Ä–∏", "–í–∫–ª—é—á–∞–µ—Ç—Å—è –∏ —Å—Ä–∞–∑—É –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è", "–°–±–æ–π —Å–µ–Ω—Å–æ—Ä–∞", "–¢–µ—á–µ—Ç –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç",
    // ...+40
  ];
  // –Ω–∞ —Å–ª—É—á–∞–π –Ω–æ–≤–æ–π custom –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  return [
    "–û–±—â–∞—è –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å", "–¢—Ä–µ–±—É–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏", "–ù–µ—Ç –ø–∏—Ç–∞–Ω–∏—è", "–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞", "–ü—Ä–æ–±–ª–µ–º—ã —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º",
    // ...–µ—â—ë 5+
  ];
}
function bigDiagnosisList(category) {
  if (category.startsWith("–•–æ–ª–æ–¥") || category.startsWith("Refriger")) return [
    "–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä", "–¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—Ä–∞–≤–∫–∞ —Ñ—Ä–µ–æ–Ω–æ–º", "–£—Ç–µ—á–∫–∞ —Ö–ª–∞–¥–∞–≥–µ–Ω—Ç–∞", "–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω –º–æ–¥—É–ª—å", 
    "–°–ª–æ–º–∞–Ω –¥–∞—Ç—á–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã", "–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä", "–ó–∞–∫–ª–∏–Ω–∏–ª–æ —Ä–µ–ª–µ", "–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–ª–∞—Ç–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω –¢–≠–ù –æ—Ç—Ç–∞–π–∫–∏",
    "–ü–ª–æ—Ö–æ–π —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª—å –¥–≤–µ—Ä–∏", "–ü–æ–ª–æ–º–∫–∞ –ø—Ä–æ–≤–æ–¥–∫–∏", "–°–±–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏", "–ü—Ä–æ–±–ª–µ–º–∞ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞", "–°–ª–æ–º–∞–Ω –¥–∏—Å–ø–ª–µ–π",
    // ...+40
  ];
  if (category.startsWith("–ü–æ—Å—É–¥") || category.startsWith("Dish")) return [
    "–°–ª–æ–º–∞–Ω –Ω–∞—Å–æ—Å", "–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω –¢–≠–ù", "–ü–æ–ª–æ–º–∫–∞ –¥–∞—Ç—á–∏–∫–∞ —É—Ä–æ–≤–Ω—è –≤–æ–¥—ã", "–ü–µ—Ä–µ–∫—Ä—ã—Ç —Å–ª–∏–≤", "–ó–∞—Å–æ—Ä —Ñ–∏–ª—å—Ç—Ä–∞", "–°–ª–æ–º–∞–Ω –∑–∞–º–æ–∫ –¥–≤–µ—Ä—Ü—ã",
    "–û–∫–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∫–∏", "–ù–µ–∏—Å–ø—Ä–∞–≤–Ω–∞ –ø–ª–∞—Ç–∞", "–°–ª–æ–º–∞–Ω –¥–æ–∑–∞—Ç–æ—Ä", "–í—ã—Ö–æ–¥ –∏–∑ —Å—Ç—Ä–æ—è –∫–ª–∞–ø–∞–Ω–∞", "–°–ª–æ–º–∞–Ω –¥–≤–∏–≥–∞—Ç–µ–ª—å", "–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω —Ç–∞–π–º–µ—Ä",
    // ...+40
  ];
  if (category.startsWith("–°—Ç–∏—Ä–∞–ª") || category.startsWith("Washing")) return [
    "–°–ª–æ–º–∞–Ω –¢–≠–ù", "–ù–µ–∏—Å–ø—Ä–∞–≤–Ω–∞ –ø–æ–º–ø–∞", "–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä", "–ü–æ–≤—Ä–µ–∂–¥—ë–Ω —Ä–µ–º–µ–Ω—å", "–ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç—á–∏–∫–æ–º –≤–∏–±—Ä–∞—Ü–∏–∏", "–ü–µ—Ä–µ–∫–æ—Å –±–∞–∫–∞",
    "–ü—Ä–æ–±–ª–µ–º–∞ —Å –º–æ—Ç–æ—Ä–æ–º", "–ü–æ–ª–æ–º–∫–∞ –ª—é–∫–∞", "–ò–∑–Ω–æ—Å —â—ë—Ç–æ–∫ –¥–≤–∏–≥–∞—Ç–µ–ª—è", "–ü—Ä–æ–±–∏—Ç–∞ –º–∞–Ω–∂–µ—Ç–∞", "–°–ª–æ–º–∞–Ω –ø—Ä–µ—Å—Å–æ—Å—Ç–∞—Ç",
    // ...+40
  ];
  // ...–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  return ["–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"];
}
function bigActionsList(category) {
  if (category.startsWith("–•–æ–ª–æ–¥") || category.startsWith("Refriger")) return [
    "–ó–∞–º–µ–Ω—ë–Ω –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä", "–î–æ–±–∞–≤–ª–µ–Ω —Ö–ª–∞–¥–∞–≥–µ–Ω—Ç", "–ü–æ—á–∏—â–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞", "–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–æ–≤—ã–π –¥–∞—Ç—á–∏–∫", "–û—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
    "–ó–∞–º–µ–Ω–µ–Ω–∞ –ø–ª–∞—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –¥–≤–µ—Ä—Ü—ã", "–ó–∞–º–µ–Ω–∞ —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç–∞", "–ü—Ä–æ—Ç—è–Ω—É—Ç–∞ –ø—Ä–æ–≤–æ–¥–∫–∞", "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¢–≠–ù–∞ –æ—Ç—Ç–∞–π–∫–∏",
    // ...+40
  ];
  if (category.startsWith("–ü–æ—Å—É–¥") || category.startsWith("Dish")) return [
    "–ó–∞–º–µ–Ω—ë–Ω –¢–≠–ù", "–ü—Ä–æ–º—ã—Ç–∞ —Å–∏—Å—Ç–µ–º–∞", "–ó–∞–º–µ–Ω—ë–Ω –Ω–∞—Å–æ—Å", "–ó–∞–º–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞", "–ü–æ—á–∏—â–µ–Ω —Ä–∞–∑–±—Ä—ã–∑–≥–∏–≤–∞—Ç–µ–ª—å", "–ó–∞–º–µ–Ω–∞ –∑–∞–º–∫–∞ –¥–≤–µ—Ä—Ü—ã",
    "–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–æ–≤—ã–π –¥–æ–∑–∞—Ç–æ—Ä", "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∫–∏", "–ó–∞–º–µ–Ω–∞ –∫–ª–∞–ø–∞–Ω–∞", "–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
    // ...+40
  ];
  if (category.startsWith("–°—Ç–∏—Ä–∞–ª") || category.startsWith("Washing")) return [
    "–ó–∞–º–µ–Ω—ë–Ω –¢–≠–ù", "–ü—Ä–æ–º—ã—Ç–∞ –ø–æ–º–ø–∞", "–ó–∞–º–µ–Ω–∞ —Ä–µ–º–Ω—è –ø—Ä–∏–≤–æ–¥–∞", "–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –º–∞–Ω–∂–µ—Ç–∞", "–û—Ç—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–æ –∫—Ä–µ–ø–ª–µ–Ω–∏–µ –±–∞–∫–∞",
    "–ü–æ—á–∏—â–µ–Ω —Ñ–∏–ª—å—Ç—Ä", "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–ø—Ä–æ–≤–æ–¥–∫–∞", "–ó–∞–º–µ–Ω—ë–Ω –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä", "–°–º–∞–∑–∞–Ω –ø–æ–¥—à–∏–ø–Ω–∏–∫", "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–æ—Å–∞–¥–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞",
    // ...+40
  ];
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  return [
    "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è", "–ú–µ–ª–∫–∏–π —Ä–µ–º–æ–Ω—Ç", "–†–∞–±–æ—Ç–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞", "–û–±—â–∞—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞"
  ];
}

// –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
function engList(list) {
  return list.map(s => s
    .replace("–ù–µ", "Not ").replace("–ù–µ—Ç", "No ")
    .replace("–°–ª–æ–º–∞–Ω", "Broken ").replace("–ù–µ–∏—Å–ø—Ä–∞–≤–µ–Ω", "Faulty ")
    //... –µ—â—ë –∞–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥? –ú–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å –∏–ª–∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å –≤—Ä—É—á–Ω—É—é
  );
}
function statusOptions(lang) {
  return (lang === 'ru') ? [
    "–ì–æ—Ç–æ–≤–æ", "–í —Ä–∞–±–æ—Ç–µ", "–û–∂–∏–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞", "–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–∏–∑–∏—Ç", "–û–∂–∏–¥–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏"
  ] : [
    "Ready", "In Progress", "Waiting for Client", "Repeat Visit Needed", "Waiting for Part"
  ];
}

/** ------- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞—Ç ------- **/
function makeMonths(lang) {
  const monthsRU = ["–Ø–Ω–≤–∞—Ä—å","–§–µ–≤—Ä–∞–ª—å","–ú–∞—Ä—Ç","–ê–ø—Ä–µ–ª—å","–ú–∞–π","–ò—é–Ω—å","–ò—é–ª—å","–ê–≤–≥—É—Å—Ç","–°–µ–Ω—Ç—è–±—Ä—å","–û–∫—Ç—è–±—Ä—å","–ù–æ—è–±—Ä—å","–î–µ–∫–∞–±—Ä—å"];
  const monthsEN = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  return lang == "ru" ? monthsRU : monthsEN;
}
function makeYears() {
  let arr = [];
  let y = (new Date()).getFullYear();
  for (let i = 0; i < 25; ++i) arr.push(y - i);
  return arr;
}

/** ------- –Ø–∑—ã–∫–æ–≤–æ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ------- **/
let modeClient = false; // false ‚Äî technician/ru, true ‚Äî client/en
function switchLangUI(toClient) {
  const lang = toClient ? 'en' : 'ru';

  document.getElementById("modeLabel").innerText   = i18n[lang][toClient?"modeClient":"modeTech"];
  document.getElementById("mainTitle").innerText   = i18n[lang]["mainTitle"];
  document.getElementById("catLabel").innerText    = i18n[lang]["category"];
  document.getElementById("brandLabel").innerText  = i18n[lang]["brand"];
  document.getElementById("modelLabel").innerText  = i18n[lang]["model"];
  document.getElementById("serialLabel").innerText = i18n[lang]["serial"];
  document.getElementById("problemLabel").innerText= i18n[lang]["problem"];
  document.getElementById("diagLabel").innerText   = i18n[lang]["diagnosis"];
  document.getElementById("actionsLabel").innerText= i18n[lang]["actions"];
  document.getElementById("priceLabel").innerText  = i18n[lang]["price"];
  document.getElementById("releaseMonthLabel").innerText = i18n[lang]["month"];
  document.getElementById("releaseYearLabel").innerText = i18n[lang]["year"];
  document.getElementById("notesLabel").innerText  = i18n[lang]["notes"];
  document.getElementById("statusLabel").innerText = i18n[lang]["status"];
  document.getElementById("makeReportBtn").innerText = i18n[lang]["reportBtn"];
  document.getElementById("clearFormBtn").innerText  = i18n[lang]["clear"];
  document.getElementById("templateTitle").innerText = i18n[lang]["templateTitle"];
  document.getElementById("copyTemplateBtn").innerText = i18n[lang]["copy"];
  document.getElementById("historyTitle").innerText  = i18n[lang]["history"];
  document.getElementById("copyAllBtn").innerText    = i18n[lang]["copyAll"];
  document.getElementById("clearHistoryBtn").innerText = i18n[lang]["clearHistory"];
  document.getElementById("footNote").innerText      = i18n[lang]["footNote"];

  // –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å—ã –∏ "months/years"
  let statusSel = document.getElementById("status");
  statusSel.innerHTML = "";
  statusOptions(lang).forEach(v => {
    let option = document.createElement("option");
    option.textContent = v;
    statusSel.appendChild(option);
  });
  document.getElementById("releaseMonth").innerHTML = makeMonths(lang).map(m=>`<option>${m}</option>`).join("");
  document.getElementById("releaseYear").innerHTML = makeYears().map(y=>`<option>${y}</option>`).join("");
}

/* ---- PART 2/4 END ---- */

            /* ---- PART 3/4 START ---- */

// --- LocalStorage helpers ---
function lsGet(key, def=[]) {
  try { return JSON.parse(localStorage.getItem(key)) ?? def } catch { return def }
}
function lsSet(key, val) {
  localStorage.setItem(key, JSON.stringify(val));
}

// ----- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è custom –ø—É–Ω–∫—Ç–æ–≤ -----
let custom = lsGet('customFields', {
  category:[], brand:[], problem:{}, diagnosis:{}, actions:{}
});

// unique push
function pushUnique(arr, val) {
  if (!arr.includes(val)) arr.push(val);
}

// --- –†–µ–Ω–¥–µ—Ä —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ + –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ ---
function fillSelect(id, list, customList, onDel, addBtnId) {
  const sel = document.getElementById(id);
  sel.innerHTML = "";
  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
  list.forEach(val => {
    let opt = document.createElement("option");
    opt.textContent = val;
    sel.appendChild(opt);
  });
  // –ö–∞—Å—Ç–æ–º –∑–Ω–∞—á–µ–Ω–∏—è
  if (customList && customList.length) {
    customList.forEach(val => {
      let opt = document.createElement("option");
      opt.textContent = val;
      opt.style.color = "#2237cc";
      sel.appendChild(opt);
    });
  }
  // –û—Ç–¥–µ–ª—å–Ω–æ –æ—Ç—Ä–∏—Å—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–Ω–æ–ø–∫–æ–π —É–¥–∞–ª–µ–Ω–∏—è
  let fieldListEl = document.getElementById(id+"List");
  if (fieldListEl) {
    fieldListEl.innerHTML = "";
    if (customList && customList.length) {
      customList.forEach((val, idx) => {
        let div = document.createElement("span");
        div.className = "custom-item";
        div.textContent = val;
        let del = document.createElement("button");
        del.className = "del-btn";
        del.innerText = "√ó";
        del.title = "–£–¥–∞–ª–∏—Ç—å";
        del.onclick = () => { onDel(idx); }
        div.appendChild(del);
        fieldListEl.appendChild(div);
      });
    }
  }
  if (addBtnId) {
    document.getElementById(addBtnId).onclick = () => {
      let newVal = prompt((modeClient ? "Enter new" : "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π")+" "+id);
      if (!newVal || newVal.length<2) return;
      pushUnique(custom[id] ?? (custom[id]=[]), newVal.trim());
      lsSet('customFields', custom);
      rebuildDynamicForm();
    }
  }
}

// –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–ø–∏—Å–∫–∏ –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function rebuildDynamicForm() {
  let selCat = document.getElementById("category").value || categories[0].ru;
  let catEn = categories.find(c=>c.ru==selCat||c.en==selCat)?.en || selCat;
  let isRu = !modeClient;
  // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
  let catList = categories.map(c => isRu?c.ru:c.en);
  fillSelect("category", catList, custom.category, (idx)=>{
    custom.category.splice(idx,1); lsSet('customFields',custom); rebuildDynamicForm();
  }, "addCategoryBtn");
  // –ë—Ä–µ–Ω–¥—ã
  fillSelect("brand", brands, custom.brand, (idx)=>{
    custom.brand.splice(idx,1); lsSet('customFields',custom); rebuildDynamicForm();
  }, "addBrandBtn");
  // –ü—Ä–æ–±–ª–µ–º—ã
  let plist = bigProblemList(selCat);
  let plistE = modeClient ? engList(plist) : plist;
  fillSelect("problem", plistE, (custom.problem[catEn]||[]), (idx)=>{
    (custom.problem[catEn]??=[]).splice(idx,1); lsSet('customFields',custom); rebuildDynamicForm();
  }, "addProblemBtn");
  document.getElementById("addProblemBtn").onclick = () => {
    let input = prompt(modeClient?"Enter new problem":"–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É");
    if (!input || input.length < 2) return;
    pushUnique(custom.problem[catEn]??(custom.problem[catEn]=[]), input.trim());
    lsSet('customFields', custom);
    rebuildDynamicForm();
  };
  // –î–∏–∞–≥–Ω–æ–∑—ã
  let dlist = bigDiagnosisList(selCat);
  let dlistE = modeClient ? engList(dlist) : dlist;
  fillSelect("diagnosis", dlistE, (custom.diagnosis[catEn]||[]), (idx)=>{
    (custom.diagnosis[catEn]??=[]).splice(idx,1); lsSet('customFields',custom); rebuildDynamicForm();
  }, "addDiagnosisBtn");
  document.getElementById("addDiagnosisBtn").onclick = () => {
    let input = prompt(modeClient?"Enter new diagnosis":"–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–≥–Ω–æ–∑");
    if (!input || input.length < 2) return;
    pushUnique(custom.diagnosis[catEn]??(custom.diagnosis[catEn]=[]), input.trim());
    lsSet('customFields', custom);
    rebuildDynamicForm();
  };
  // –î–µ–π—Å—Ç–≤–∏—è
  let alist = bigActionsList(selCat);
  let alistE = modeClient ? engList(alist) : alist;
  fillSelect("actions", alistE, (custom.actions[catEn]||[]), (idx)=>{
    (custom.actions[catEn]??=[]).splice(idx,1); lsSet('customFields',custom); rebuildDynamicForm();
  }, "addActionsBtn");
  document.getElementById("addActionsBtn").onclick = () => {
    let input = prompt(modeClient?"Enter new action":"–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ");
    if (!input || input.length < 2) return;
    pushUnique(custom.actions[catEn]??(custom.actions[catEn]=[]), input.trim());
    lsSet('customFields', custom);
    rebuildDynamicForm();
  };
}

// –°–º–µ–Ω–∞ —è–∑—ã–∫–∞ –∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
document.getElementById("modeClient").onchange = function() {
  modeClient = this.checked;
  switchLangUI(modeClient);
  rebuildDynamicForm();
  document.getElementById("templateOutput").value = "";
};

// –ö–∞—Ç–µ–≥–æ—Ä–∏—è ‚Äî –¥–∏–Ω–∞–º–∏–∫–∞ –±—Ä–µ–Ω–¥–∞/–ø–æ–ª–µ–π
document.getElementById("category").onchange = function() {
  rebuildDynamicForm();
  document.getElementById("brand").selectedIndex = 0;
  document.getElementById("problem").selectedIndex = 0;
  document.getElementById("diagnosis").selectedIndex = 0;
  document.getElementById("actions").selectedIndex = 0;
};

/** ---- –ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤ ---- **/

function loadReports() {
  return lsGet("reports",[]);
}
function saveReport(rep) {
  let rs = loadReports();
  rs.push(rep);
  lsSet("reports", rs);
  return rs;
}
function removeReport(idx) {
  let rs = loadReports();
  rs.splice(idx, 1);
  lsSet("reports", rs);
}
function clearReports() {
  lsSet("reports", []);
}

// --- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
function renderHistory() {
  let historyBlock = document.getElementById("reportsArea");
  let rps = loadReports();
  historyBlock.innerHTML = "";
  if (!rps.length) {
    historyBlock.innerHTML = `<div style="color:#888;margin:10px 0 12px">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>`;
    return;
  }
  rps.slice().reverse().forEach((rp, i) => {
    let ix = rps.length-1-i;
    let div = document.createElement("div");
    div.className = "report-item";
    div.innerHTML =
      `<div><b>${rp.category}</b> (${rp.brand} ${rp.model})<br>${rp.problem}, ${rp.diagnosis}, ${rp.actions}</div>
       <div>${rp.month} ${rp.year}; <b>${rp.price}</b>‚ÇΩ; [${rp.status}]</div>
       <div>${rp.notes?'<i>'+rp.notes+'</i>':''}</div>
      <div class="report-actions">
        <button class="small-btn copy-btn" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å" onclick="navigator.clipboard.writeText(\`${makeTemplate(rp)}\`)">üìã</button>
        <button class="small-btn del-btn" title="–£–¥–∞–ª–∏—Ç—å" onclick="removeReport(${ix});renderHistory();">üóë</button>
      </div>`;
    historyBlock.appendChild(div);
  });
}

/** ---- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ ---- **/
function makeTemplate(obj) {
  if (modeClient) {
    return `Category: ${obj.category}
Brand: ${obj.brand}
Model: ${obj.model}
Problem: ${obj.problem}
Diagnosis: ${obj.diagnosis}
Action: ${obj

          /* ---- PART 4/4 START ---- */
window.onload = function() {
  // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –º–µ—Å—è—Ü–µ–≤/–≥–æ–¥–æ–≤
  switchLangUI(modeClient);
  document.getElementById("releaseMonth").innerHTML = makeMonths("ru").map(m=>`<option>${m}</option>`).join("");
  document.getElementById("releaseYear").innerHTML = makeYears().map(y=>`<option>${y}</option>`).join("");
  // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—ã, –±–∞–∑–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã/–¥–∏–∞–≥–Ω–æ–∑—ã –¥–ª—è –ø–µ—Ä–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  rebuildDynamicForm();
  renderHistory();
  // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ñ–æ—Ä–º—ã
  document.getElementById("category").selectedIndex = 0;
  document.getElementById("brand").selectedIndex = 0;
  document.getElementById("problem").selectedIndex = 0;
  document.getElementById("diagnosis").selectedIndex = 0;
  document.getElementById("actions").selectedIndex = 0;
};
/* ---- PART 4/4 END ---- */
</script>
</body>
</html>
</script>
